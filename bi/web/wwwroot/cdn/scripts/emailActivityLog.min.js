var emailLogStartDateTime="",emailLogEndDateTime="";function setTimpickerValue(){emailLogEndDateTime="True"==emailActivityLogTimeFomat?(emailLogStartDateTime="00:00","23:59"):(emailLogStartDateTime="12:00 AM","11:59 PM")}function openEmailLogDetails(){var e=angular.element("[ng-controller=EmailLogInfoCtrl]").scope(),t=$("#emailActivityLogGrid").ejGrid("instance"),t=t.getCurrentViewData()[t.getIndexByRow($("tr.e-row[aria-selected *='true']"))],a=$("<div/>").html(t.MailBody).text();t.MailBody=a,e.openEmailLogInfoDialog(t)}function fnActionBegin(e){var t,a=[];if(0<e.model.filterSettings.filteredColumns.length){for(t=0;t<e.model.filterSettings.filteredColumns.length;t++){var i=e.model.filterSettings.filteredColumns[t];a.push({PropertyName:i.field,FilterType:i.operator,FilterKey:i.value})}this.model.query._params.push({key:"filterCollection",value:a})}}function DateRangeLocalization(){var e={customPicker:window.Server.App.Localization.CustomPicker,watermarkText:window.Server.App.Localization.SelectRange};"undefined"!=typeof BoldBIDashboard?BoldBIDashboard.DateRangePicker.Locale["en-US"]=e:ej.DateRangePicker.Locale["en-US"]=e}$(document).ready(function(){$("[data-toggle='tooltip'], .selectpicker").tooltip(),DateRangeLocalization(),$("#datePicker").ejDateRangePicker({dateFormat:emailActivityLogDateFormat,locale:"en-US",buttonText:{apply:window.Server.App.Localization.Apply,cancel:window.Server.App.Localization.CancelButton,reset:window.Server.App.Localization.Reset},ranges:[{label:window.Server.App.Localization.Today,range:[new Date,new Date]},{label:window.Server.App.Localization.Yesterday,range:[new Date((new Date).setDate((new Date).getDate()-1)),new Date((new Date).setDate((new Date).getDate()-1))]},{label:window.Server.App.Localization.LastDays.format("7"),range:[new Date((new Date).setDate((new Date).getDate()-7)),new Date]},{label:window.Server.App.Localization.LastDays.format("15"),range:[new Date((new Date).setDate((new Date).getDate()-14)),new Date]},{label:window.Server.App.Localization.LastDays.format("30"),range:[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},{label:window.Server.App.Localization.LastDays.format("60"),range:[new Date((new Date).setMonth((new Date).getMonth()-2)),new Date]},{label:window.Server.App.Localization.ThisWeek,range:[new Date((new Date).setDate((new Date).getDate()-(new Date).getDay())),new Date((new Date).setDate((new Date).getDate()-(new Date).getDay()+6))]},{label:window.Server.App.Localization.ThisMonth,range:[new Date((new Date).getFullYear(),(new Date).getMonth(),1),new Date((new Date).getFullYear(),(new Date).getMonth()+1,0)]}]});var a=$("#emailActivityLogGrid").ejGrid("instance");$(".e-gridheader .e-filtericon").mousedown(function(e){var t=e.target;$("#emailActivityLogGrid_stringDlg").ejDialog({open:function(e){"Status"==$(t).parent().find(".e-headercelldiv").attr("ej-mappingname")&&($("#emailActivityLogGridstring_ddinput_hidden").val("Contains"),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='Equal']").hide(),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='NotEqual']").hide(),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='StartsWith']").hide(),$("#"+a._id+"string_ddinput_popup_wrapper").find("li[value='EndsWith']").hide())}})})}),$(document).on("click","#email-log-filter-apply-button",function(){$.ajax({type:"GET",url:emailSettingsPagePermissionUrl,data:{scope:SettingsScopes.Email},success:function(e){var t,a,i,n;e.status?(setTimpickerValue(),t=$("#datePicker").val().split("-"),n=""!=$.trim(t[0])?$.trim(t[0])+" "+emailLogStartDateTime:"",t=""!=$.trim(t[1])?$.trim(t[1])+" "+emailLogEndDateTime:"",a=$("#email-event").val().toString(),i=$("#emailActivityLogGrid").data("ejGrid"),n=ej.DataManager({url:filterEmailLogsUrl+"?startDate="+n+"&endDate="+t+"&eventType="+a,adaptor:new ej.UrlAdaptor}),i.dataSource(n),i.model.pageSettings.currentPage=1):e.permissionDenied&&warningToast(window.Server.App.Localization.AdminPageAccessWarningAlert,null,(new Date).getTime())}})}),$(document).on("click",".email-log-info",function(){openEmailLogDetails()}),serverApp.controller("EmailLogInfoCtrl",["$scope","$timeout",function(t,a){t.EmailLogDetail=null,t.closeItemInfo=function(){$("#emaillog-info-popup").ejDialog("close"),$(".mail-error-message").hide()},t.openEmailLogInfoDialog=function(e){""!=e.StatusMessage&&null!=e.StatusMessage&&$(".mail-error-message").show(),t.EmailLogDetail=e,$("#emaillog-info-popup").ejDialog({width:480<window.innerWidth?"400px":window.innerWidth-10+"px",height:"548px",showOnInit:!1,allowDraggable:!1,enableResize:!1,showHeader:!1,enableModal:!0}),$("#emaillog-info-popup").ejDialog("open"),$("#emaillog-info-popup").ejDialog("refresh"),a(function(){t.$apply()},100)}}]);