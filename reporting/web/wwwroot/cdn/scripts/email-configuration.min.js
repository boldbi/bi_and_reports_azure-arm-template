function getEmailPassword(){var e=$("#mail-password");""===e.val()&&(parseInt($("#port-number").val())!==window.SystemSettingsProperties.MailSettingsPort||$("#smtp-address").val()!==window.SystemSettingsProperties.MailSettingsHost||$("#mail-display-name").val()!==window.SystemSettingsProperties.MailSettingsSenderName||$("#mail-user-name").val()!==window.SystemSettingsProperties.MailSettingsAddress||$("#secure-mail-authentication").is(":checked")!==window.SystemSettingsProperties.MailSettingsIsSecureAuthentication?e.attr("placeholder",window.Server.App.LocalizationContent.PasswordPlaceholder).siblings(".placeholder").html(window.Server.App.LocalizationContent.PasswordPlaceholder):e.attr("placeholder","●●●●●●●●").siblings(".placeholder").html("●●●●●●●●"))}function extractXSRFTokenFromCookie(){var e=parent.document.cookie.split("; ").find(e=>e.startsWith("XSRF-TOKEN="));return e?e.split("=")[1]:null}function setXSRFRequestHeader(e){e.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function EscapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}$(document).ready(function(){$("#mail-password").show(),$.validator.addMethod("noEmptySpaces",function(e,t){return""!==$.trim(e)}),$.validator.addMethod("isValidPort",function(){return intRegex.test($("#port-number").val())}),$("#email-setting-form").validate({errorElement:"span",onkeyup:function(e,t){9!=t.keyCode&&(isKeyUp=!0,("mail-password"!==e.id||""!==$(e).val())&&$(e).valid(),isKeyUp=!1)},onfocusout:function(e){("mail-password"!==e.id||""===$(e).val())&&$(e).valid()},rules:{smtp_address:{required:{depends:function(){return 0===parseInt($("#mail-account").val())}},noEmptySpaces:!0},port_number:{required:{depends:function(){return 0===parseInt($("#mail-account").val())}},noEmptySpaces:!0,isValidPort:!0},mail_display_name:{required:{depends:function(){return 0===parseInt($("#mail-account").val())}},isValidName:{depends:function(){return 0===parseInt($("#mail-account").val())}},noEmptySpaces:!0},mail_user_name:{required:{depends:function(){return 0===parseInt($("#mail-account").val())||1===parseInt($("#mail-account").val())}},isValidEmail:{depends:function(){return 0===parseInt($("#mail-account").val())||1===parseInt($("#mail-account").val())}},noEmptySpaces:!0},mail_password:{required:{depends:function(){return 0===parseInt($("#mail-account").val())}},noEmptySpaces:!0},sender_user_name:{required:{depends:function(){return 0===parseInt($("#mail-account").val())}},noEmptySpaces:!0},tenant_id:{required:{depends:function(){return 1===parseInt($("#mail-account").val())}},noEmptySpaces:!0},client_id:{required:{depends:function(){return 1===parseInt($("#mail-account").val())}},noEmptySpaces:!0},client_secret:{required:{depends:function(){return 1===parseInt($("#mail-account").val())}},noEmptySpaces:!0}},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error"),$(e).parent().find("span.validation-errors").html("")},errorPlacement:function(e,t){$(t).parent().find("span.validation-errors").html(e)},messages:{smtp_address:{required:window.Server.App.LocalizationContent.MailSMTPServerValidator,noEmptySpaces:window.Server.App.LocalizationContent.MailSMTPServerValidator},port_number:{required:window.Server.App.LocalizationContent.MailSMTPPortValidator,noEmptySpaces:window.Server.App.LocalizationContent.MailSMTPPortValidator,isValidPort:window.Server.App.LocalizationContent.IsValidPort},mail_display_name:{required:window.Server.App.LocalizationContent.SenderNameValidator,noEmptySpaces:window.Server.App.LocalizationContent.SenderNameValidator},mail_user_name:{required:window.Server.App.LocalizationContent.SenderEmailValidator,noEmptySpaces:window.Server.App.LocalizationContent.SenderEmailValidator},mail_password:{required:window.Server.App.LocalizationContent.PasswordValidator,noEmptySpaces:window.Server.App.LocalizationContent.PasswordValidator},sender_user_name:{required:window.Server.App.LocalizationContent.UserNameValidator,noEmptySpaces:window.Server.App.LocalizationContent.UserNameValidator},tenant_id:{required:window.Server.App.LocalizationContent.TenantId,noEmptySpaces:window.Server.App.LocalizationContent.TenantId},client_id:{required:window.Server.App.LocalizationContent.ClientId,noEmptySpaces:window.Server.App.LocalizationContent.ClientId},client_secret:{required:window.Server.App.LocalizationContent.ClientSecret,noEmptySpaces:window.Server.App.LocalizationContent.ClientSecret}}}),$(".mail-settings-fields:not('#mail-password')").keyup(function(e){getEmailPassword()}),$("#mail-authentication-type").selectpicker("destroy"),$("#mail-authentication-type").selectpicker(),$("#test-mail-connection").tooltip()}),$(document).on("change","#secure-mail-authentication",function(){getEmailPassword()}),$(document).on("change","#mail-authentication-type",function(){var e=$(".mail-credentials");1===parseInt($(this).val())?e.removeAttr("disabled"):(e.attr("disabled","disabled").val("").parent().parent().removeClass("has-error"),e.siblings(".validation-errors").text(""))}),$(document).on("change","#mail-password , #sender-user-name",function(){""!==$("#mail-password").val()&&$("#mail-password-error").remove(),""!==$("#sender-user-name").val()&&$("#sender-user-name-error").remove()}),$.ajaxSetup({beforeSend:function(e){setXSRFRequestHeader(e)}});
