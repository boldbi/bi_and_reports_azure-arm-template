var publishedDashboardInfo="",isPublishDialogBinded=!1,resetAngularEvent=!1,isAdvancedPage=!1;function publishSiteDetailDialog(e){publishedDashboardInfo=e;var t='<span class ="publish-dialog-header">'+window.Server.App.LocalizationContent.PublishDialogHeader+"</span>";if(isPublishDialogBinded){(a=document.getElementById("publish-site-dialog").ej2_instances)[0].header=t,a[0].btnObj[0].disabled=!0,a[0].show()}else{var a,i=document.createElement("div");i.setAttribute("id","publish-site-dialog"),document.getElementById("dashboard-page-container").appendChild(i),(a=new ejs.popups.Dialog({header:t,content:document.getElementById("publish-site-content"),buttons:[{click:function(e){e.currentTarget.ej2_instances[0].content==window.Server.App.LocalizationContent.Back?backToPublishDialog():advancedPublishDialog()},buttonModel:{disabled:!0,content:window.Server.App.LocalizationContent.Advanced}},{click:function(e){e.currentTarget.ej2_instances[0].content==window.Server.App.LocalizationContent.Submit&&submitTargetSiteDetails(),e.currentTarget.ej2_instances[0].content==window.Server.App.LocalizationContent.Next&&backToPublishDialog()},buttonModel:{isPrimary:!0,content:window.Server.App.LocalizationContent.Submit}},{click:function(){a.hide(),isAdvancedPage=!1},buttonModel:{content:window.Server.App.LocalizationContent.CloseButton}}],animationSettings:{effect:"Zoom"},open:validatePublishItem,beforeOpen:beforeOpenPublishDialog,beforeClose:beforeClosePublishDialog,width:"700px",showCloseIcon:!0,isModal:!0})).appendTo(i),isPublishDialogBinded=!0}ejs.popups.createSpinner({target:document.getElementById("publish-site-dialog")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("publish-site-dialog"))}function beforeOpenPublishDialog(){$("#publish-site-content").show(),$("#publish-advanced-container").hide();var e=document.getElementById("publish-site-dialog").ej2_instances;isSelfHosted&&isMaster?($("#publish-base-container").hide(),$("#publish-select-site-container").show(),e[0].btnObj[1].content=window.Server.App.LocalizationContent.Next,e[0].btnObj[0].cssClass="display-none"):(e[0].btnObj[1].content=window.Server.App.LocalizationContent.Submit,e[0].btnObj[0].cssClass="",$("#publish-select-site-container").hide(),$("#publish-base-container").show(),angular.element("[ng-controller=PublishCtrl]").scope().publishType="External")}function validatePublishItem(){$.ajax({type:"GET",url:validatePublishItemUrl,data:{itemId:publishedDashboardInfo.Id},success:function(e){if(e.Result){var t=angular.element("[ng-controller=PublishCtrl]").scope();ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),isSelfHosted&&isMaster?$("#internal-site").click():(t.publishType="External",backToPublishDialog())}else{document.getElementById("publish-site-dialog").ej2_instances[0].hide(),WarningAlert(window.Server.App.LocalizationContent.PublishDashboard,window.Server.App.LocalizationContent.PublishItemValidation,7e3)}}})}function beforeClosePublishDialog(){var e=angular.element("[ng-controller=PublishCtrl]").scope();document.getElementById("publish-site-dialog").ej2_instances[0].btnObj[0].content=window.Server.App.LocalizationContent.Advanced,e.selectedSites=[],e.activeSites=[],e.selectedDatasources=[],e.selectedDatasets=[],e.targetSiteDetail=[],e.userLists=[],e.updateDatasources=[],e.updateUser=[],e.updateSites=[],e.publishType="Internal",$("#multiselect-dropdown").empty(),$("#multiselect-dropdown").selectpicker("destroy"),$("#multiselect-dropdown").selectpicker(),$("#publish-category-name").val(""),$("#use-source-name").prop("checked",!1),$("#publish-report-descrition").val(""),$("#publish-report-edit").prop("checked",!1),$("#publish-datasource-edit").prop("checked",!1),$("#publish-dataset-edit").prop("checked",!1),removeCategoryValidation(),removeDropdownValidation()}function advancedPublishDialog(){isAdvancedPage=!0,ejs.popups.showSpinner(document.getElementById("publish-site-dialog"));var e=document.getElementById("publish-site-dialog").ej2_instances;e[0].btnObj[0].content=window.Server.App.LocalizationContent.Back,e[0].btnObj[1].content=window.Server.App.LocalizationContent.Submit;var t=angular.element("[ng-controller=PublishCtrl]").scope();$(".selected-sites li").hasClass("active")?t.selectedSites.some(e=>e.TenantId==t.activeMenu.TenantId)||(t.activeMenu=t.selectedSites[0]):(t.activeMenu=t.selectedSites[0],$(".selected-sites li:first").addClass("active"));t.$apply(),updateUsersList()}function backToPublishDialog(){isAdvancedPage=!1,ejs.popups.showSpinner(document.getElementById("publish-site-dialog"));var e=angular.element("[ng-controller=PublishCtrl]").scope(),t=document.getElementById("publish-site-dialog").ej2_instances;isSelfHosted&&(t[0].btnObj[0].cssClass="",t[0].btnObj[1].content=window.Server.App.LocalizationContent.Submit),"Internal"==e.publishType?($("#active-sites-dropdown").removeClass("external-dropdown"),$("#publish-base-container .publish-container").removeClass("external-publish-separator")):($("#active-sites-dropdown").addClass("external-dropdown"),$("#publish-base-container .publish-container").addClass("external-publish-separator")),t[0].btnObj[0].content=window.Server.App.LocalizationContent.Advanced,$("#publish-base-container").show(),$("#publish-advanced-container").hide(),$("#publish-select-site-container").hide(),updateReportName(),0===$("#multiselect-dropdown > option").length?showActiveSites(e.publishType):(ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem())}function updateTitleForDisabledItem(){$("#active-sites-dropdown .dropdown-menu .inner .disabled").attr("data-bs-toggle","tooltip"),$("#active-sites-dropdown .dropdown-menu .inner li a").hasClass("no-sites")||$("#active-sites-dropdown .dropdown-menu .inner .disabled").attr("data-original-title",window.Server.App.LocalizationContent.ItemPublishedTitle),$('[data-bs-toggle="tooltip"]').tooltip()}function showActiveSites(e){"Internal"===e?(updateActiveSites(),$("#active-sites-dropdown").removeClass("external-dropdown")):(updateExternalSites(),$("#active-sites-dropdown").addClass("external-dropdown"))}function updateUsersList(){var e=angular.element("[ng-controller=PublishCtrl]").scope();e.userDetail=[],$.each(e.selectedSites,function(t,a){$.ajax({type:"GET",url:getUsersPermissionUrl,data:{publishType:e.publishType,tenantId:a.TenantId},success:function(i){var n=[];void 0!==i.Sites&&($.each(i.Sites,function(t,a){e.userDetail.push({Name:a.DisplayName,Id:a.IdPReferenceId,UserId:a.UserId,IsSelected:0==t}),angular.copy(e.userDetail,n)}),"Internal"===e.publishType?e.sampleDetail={SiteIdentifier:a.SiteIdentifier,UserList:n}:e.sampleDetail={SiteIdentifier:a.TenantId,UserList:n},e.userLists.push(e.sampleDetail),e.sampleDetail=[],e.userDetail=[],e.selectedSites.length-1==t&&(e.selectedDatasources=[],e.selectedDatasets=[],$.ajax({type:"GET",url:getDatasourceUrl,data:{itemId:publishedDashboardInfo.Id},success:function(t){null!=t.Datasources&&$.each(t.Datasources,function(t,a){e.selectedDatasources.push({Id:a.DataSourceId,SharedDataSourceName:a.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),$.ajax({type:"GET",url:getDatasetUrl,data:{itemId:publishedDashboardInfo.Id},success:function(t){null!=t.Datasets&&$.each(t.Datasets,function(t,a){e.selectedDatasets.push({Id:a.DataSetId,SharedDataSetName:a.Name,IsLocked:$("#publish-dataset-edit").is(":checked")})}),resetAngularEvent&&(e.targetSiteDetail=[],updateDatasourceIsLocked(),updateDatasetIsLocked(),prepareTargetSiteDetail()),resetAngularEvent=!1,pushUserList(),pushDatasources(),pushDatasets(),$("#user-selected").addClass("selectpicker"),$("#user-selected").selectpicker("destroy"),$("#user-selected").selectpicker(),$('[data-bs-toggle="tooltip"]').tooltip(),$("#publish-base-container").hide(),$("#publish-select-site-container").hide(),$("#publish-advanced-container").show(),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog"))}})}})))}})})}function submitTargetSiteDetails(){if(canPublish())if(ejs.popups.showSpinner(document.getElementById("publish-site-dialog")),isAdvancedPage)publishReport();else{var e=angular.element("[ng-controller=PublishCtrl]").scope();e.selectedDatasources=[],e.selectedDatasets=[];var t=new Promise(function(t,a){$.ajax({type:"GET",url:getDatasourceUrl,data:{itemId:publishedDashboardInfo.Id},success:function(a){null!=a.Datasources&&$.each(a.Datasources,function(t,a){e.selectedDatasources.push({Id:a.DataSourceId,SharedDataSourceName:a.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),t(a)},error:function(e){a(e)}})}),a=new Promise(function(t,a){$.ajax({type:"GET",url:getDatasetUrl,data:{itemId:publishedDashboardInfo.Id},success:function(a){null!=a.Datasets&&$.each(a.Datasets,function(t,a){e.selectedDatasets.push({Id:a.DataSetId,SharedDataSetName:a.Name,IsLocked:$("#publish-dataset-edit").is(":checked")})}),t(a)},error:function(e){a(e)}})});Promise.all([t,a]).then(function(e){publishReport()})}}function publishReport(){var e=angular.element("[ng-controller=PublishCtrl]").scope(),t=document.getElementById("publish-site-dialog").ej2_instances;0==e.targetSiteDetail.length&&(e.activeMenu=e.selectedSites[0],prepareTargetSiteDetail()),pushUserList(),pushDatasources(),pushDatasets();var a={targetSiteDetail:JSON.stringify(e.targetSiteDetail),itemId:publishedDashboardInfo.Id};$.ajax({type:"POST",url:publishReportUrl,data:a,success:function(e){e.Status?SuccessAlert(window.Server.App.LocalizationContent.PublishDashboard,isNullOrWhitespace(e.StatusMessage)?window.Server.App.LocalizationContent.PublishSuccess:e.StatusMessage,7e3):WarningAlert(window.Server.App.LocalizationContent.PublishDashboard,isNullOrWhitespace(e.StatusMessage)?window.Server.App.LocalizationContent.PublishFailure:e.StatusMessage,7e3),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),t[0].hide()}})}function prepareTargetSiteDetail(){var e=angular.element("[ng-controller=PublishCtrl]").scope();$.each(e.selectedSites,function(t,a){var i=e.userLists.find(e=>e.SiteIdentifier==a.SiteIdentifier),n=[],s=[];angular.copy(e.selectedDatasources,n),angular.copy(e.selectedDatasets,s),e.sampleDetail={SiteIdentifier:a.SiteIdentifier,TenantId:a.TenantId,UserId:void 0===i||0==i.UserList.length?0:i.UserList[0].UserId,IdpReferenceIdString:void 0===i||0==i.UserList.length?null:i.UserList[0].Id,PublishItem:{CategoryName:$("#publish-category-name").val().trim(),Description:$("#publish-report-descrition").val().trim(),Name:$("#publish-report-name").val().trim(),IsLocked:$("#publish-report-edit").is(":checked")},Datasources:n,Datasets:s,PublishType:e.publishType,UseSourceItemName:$("#use-source-name").is(":checked")},e.targetSiteDetail.push(e.sampleDetail),e.sampleDetail=[]}),e.$apply()}function pushDatasources(){$("#datasource-list-dropdown").empty();var e=angular.element("[ng-controller=PublishCtrl]").scope(),t=e.targetSiteDetail.find(t=>t.TenantId==e.activeMenu.TenantId);void 0!==t&&0!=t.Datasources.length&&$.each(t.Datasources,function(e,t){t.IsLocked?$("#datasource-list-dropdown").append('<option value="'+t.Id+'"selected>'+t.SharedDataSourceName+"</option>"):$("#datasource-list-dropdown").append('<option value="'+t.Id+'">'+t.SharedDataSourceName+"</option>")}),0==e.selectedDatasources.length&&$("#datasource-list-dropdown").append("<option disabled>"+window.Server.App.LocalizationContent.NoDataSources+"</option>"),$("#datasource-list-dropdown").selectpicker("destroy"),$("#datasource-list-dropdown").selectpicker()}function pushDatasets(){$("#dataset-list-dropdown").empty();var e=angular.element("[ng-controller=PublishCtrl]").scope(),t=e.targetSiteDetail.find(t=>t.TenantId==e.activeMenu.TenantId);void 0!==t&&0!=t.Datasets.length&&$.each(t.Datasets,function(e,t){t.IsLocked?$("#dataset-list-dropdown").append('<option value="'+t.Id+'"selected>'+t.SharedDataSetName+"</option>"):$("#dataset-list-dropdown").append('<option value="'+t.Id+'">'+t.SharedDataSetName+"</option>")}),0==e.selectedDatasets.length&&$("#dataset-list-dropdown").append("<option disabled>"+window.Server.App.LocalizationContent.NoDatasets+"</option>"),$("#dataset-list-dropdown").selectpicker("destroy"),$("#dataset-list-dropdown").selectpicker()}function pushUserList(){$("#user-selected").empty();var e=angular.element("[ng-controller=PublishCtrl]").scope();e.selectedUsers=[];var t=[];t="Internal"===e.publishType?e.userLists.find(t=>t.SiteIdentifier==e.activeMenu.SiteIdentifier):e.userLists.find(t=>t.SiteIdentifier==e.activeMenu.TenantId);var a=e.targetSiteDetail.find(t=>t.TenantId==e.activeMenu.TenantId);void 0!==t&&0!=t.UserList.length&&($.each(t.UserList,function(e,t){t.IsSelected?($("#user-selected").append('<option value="'+t.UserId+'"selected>'+t.Name+"</option>"),a.UserId=t.UserId,a.IdpReferenceIdString=t.Id):$("#user-selected").append('<option value="'+t.UserId+'">'+t.Name+"</option>")}),$("#user-selected").selectpicker("destroy"),$("#user-selected").selectpicker())}function removeCategoryValidation(){$("#publish-category-validation, #advanced-category-validation, #publish-plugin-validation, #advanced-plugin-validation").html(""),$("#publish-category-name, #advanced-category-name").removeClass("has-error")}function removeDropdownValidation(){$("#active-sites-dropdown .bootstrap-select .selectpicker").removeClass("has-error"),$("#add-external-sites .btn.btn-default").removeClass("has-error"),$("#active-sites-validation").html("")}function canPublish(){var e=isAdvancedPage?$("#advanced-category-name").val().trim():$("#publish-category-name").val().trim();return $("#active-sites-dropdown li.selected").length>0?isAdvancedPage&&parent.isEmptyOrWhitespace(e)?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.LocalizationContent.ItemNameValidator),$("#advanced-category-name").addClass("has-error"),!1):parent.isEmptyOrWhitespace(e)?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.LocalizationContent.Categoryvalidator),$("#publish-category-name").addClass("has-error"),!1):(removeCategoryValidation(),removeDropdownValidation(),!0):($("#active-sites-validation").html(window.Server.App.LocalizationContent.SelectSites),$("#active-sites-dropdown .bootstrap-select .selectpicker").addClass("has-error"),$("#add-external-sites .btn.btn-default").addClass("has-error"),isAdvancedPage&&parent.isEmptyOrWhitespace(e)?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.LocalizationContent.ItemNameValidator),$("#advanced-category-name").addClass("has-error"),!1):parent.isEmptyOrWhitespace(e)?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.LocalizationContent.Categoryvalidator),$("#publish-category-name").addClass("has-error"),!1):(removeCategoryValidation(),!1))}function activateSubmit(){var e=document.getElementById("publish-site-dialog").ej2_instances,t=isAdvancedPage?$("#advanced-category-name").val().trim():$("#publish-category-name").val().trim();$("#active-sites-dropdown li.selected").length>0&&!parent.isEmptyOrWhitespace(t)?e[0].btnObj[0].disabled=!1:e[0].btnObj[0].disabled=!0}function updateDatasourceIsLocked(){var e=angular.element("[ng-controller=PublishCtrl]").scope();$.each(e.selectedDatasources,function(e,t){t.IsLocked=$("#publish-datasource-edit").is(":checked")})}function updateDatasetIsLocked(){var e=angular.element("[ng-controller=PublishCtrl]").scope();$.each(e.selectedDatasets,function(e,t){t.IsLocked=$("#publish-dataset-edit").is(":checked")})}function updateActiveSites(){$.ajax({type:"GET",url:getActiveSitesUrl,data:{itemId:publishedDashboardInfo.Id},success:function(e){var t=angular.element("[ng-controller=PublishCtrl]").scope();$.each(e.Sites,function(e,a){t.activeSites.push({TenantId:a.TenantId,SiteIdentifier:a.TenantIdentifier,TenantName:a.TenantName}),a.IsPublished?$("#multiselect-dropdown").append("<option id="+a.TenantId+" value="+a.TenantIdentifier+" disabled>"+a.TenantName+"</option>"):$("#multiselect-dropdown").append("<option id="+a.TenantId+" value="+a.TenantIdentifier+">"+a.TenantName+"</option>")}),0==e.Sites.length&&$("#multiselect-dropdown").append('<option class = "no-sites" disabled>'+window.Server.App.LocalizationContent.NoActiveSites+"</option>"),$("#multiselect-dropdown").selectpicker("destroy"),$("#multiselect-dropdown").selectpicker(),$.each(e.Sites,function(e,t){if(!t.IsPublished){var a=null!=t.DNS?t.DNS:t.SiteURL;$("#active-sites-dropdown .dropdown-menu .inner li").eq(e).attr("data-bs-toggle","tooltip").attr("data-original-title","<span class='tooltip-row'><span class='tooltip-label'>URL: </span><span class='tooltip-description'>"+a+"</span></span>").attr("data-bs-placement","right").attr("data-html","true")}}),$('#publish-site-dialog [data-bs-toggle="tooltip"]').tooltip({delay:{show:500},container:$("#publish-site-dialog")}),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem()}})}function updateReportName(){var e=angular.element("[ng-controller=PublishCtrl]").scope();isAdvancedPage?($("#advanced-source-name").is(":checked")?$("#advanced-report-name").val(publishedDashboardInfo.Name):$("#advanced-report-name").val(publishedDashboardInfo.Name+"_"+$.now()),updatedReportName=$("#advanced-report-name").val().trim()):($("#use-source-name").is(":checked")?$("#publish-report-name").val(publishedDashboardInfo.Name):$("#publish-report-name").val(publishedDashboardInfo.Name+"_"+$.now()),updatedReportName=$("#publish-report-name").val().trim()),$.each(e.targetSiteDetail,function(t,a){e.activeMenu.SiteIdentifier==a.SiteIdentifier&&(a.PublishItem.Name=updatedReportName)})}serverApp.controller("PublishCtrl",["$scope","$http",function(e,t){e.selectedSites=[],e.activeSites=[],e.userLists=[],e.selectedDatasources=[],e.selectedDatasets=[],e.targetSiteDetail=[],e.sampleDetail=[],e.activeMenu=[],e.PublishedItems=[],e.updateDatasources=[],e.updateUser=[],e.updateSites=[],e.publishType="Internal",isSelfHosted||(e.publishType="External"),e.selectPublishType=function(t){e.publishType=t},e.setActive=function(t,a){e.activeMenu=t,$(".selected-sites li").removeClass("active"),$(a.currentTarget).addClass("active"),setTimeout(function(){pushDatasources(),pushDatasets(),pushUserList(),$("#user-selected").addClass("selectpicker"),$("#user-selected").selectpicker("destroy"),$("#user-selected").selectpicker()},100)}}]),$(document).on("changed.bs.select","#multiselect-dropdown",function(e){e.stopPropagation();var t=angular.element("[ng-controller=PublishCtrl]").scope();t.selectedSites=[];var a=$("#multiselect-dropdown option:selected");a.map(function(){return this.id}).get();a.each(function(){var e=this.id,a=t.activeSites.find(function(t){return t.TenantId==e});a&&t.selectedSites.push({SiteIdentifier:a.SiteIdentifier,TenantId:a.TenantId,TenantName:a.TenantName})}),activateSubmit(),resetAngularEvent=!0,t.$apply(),$(this).parent().addClass("active")}),$(document).on("click","#selected-datasources .bootstrap-select .dropdown-menu .selectpicker li a",function(e){e.stopPropagation();var t=angular.element("[ng-controller=PublishCtrl]").scope(),a=t.targetSiteDetail.find(e=>e.TenantId==t.activeMenu.TenantId).Datasources.find(t=>t.Id==$("#selected-datasources option")[$(e.target.parentElement).index()].value);$(e.target.parentElement.parentElement).hasClass("selected")?a.IsLocked=!0:a.IsLocked=!1}),$(document).on("click","#selected-datasets .bootstrap-select .dropdown-menu .selectpicker li a",function(e){e.stopPropagation();var t=angular.element("[ng-controller=PublishCtrl]").scope(),a=t.targetSiteDetail.find(e=>e.TenantId==t.activeMenu.TenantId).Datasets.find(t=>t.Id==$("#selected-datasets option")[$(e.target.parentElement).index()].value);$(e.target.parentElement.parentElement).hasClass("selected")?a.IsLocked=!0:a.IsLocked=!1}),$(document).on("change","#user-selected",function(e){var t=angular.element("[ng-controller=PublishCtrl]").scope(),a=[],i=(a="Internal"===t.publishType?t.userLists.find(e=>e.SiteIdentifier==t.activeMenu.SiteIdentifier):t.userLists.find(e=>e.SiteIdentifier==t.activeMenu.TenantId)).UserList.find(e=>1==e.IsSelected);void 0!==i&&(i.IsSelected=!1),a.UserList.find(t=>t.UserId==$(".users-list option")[$(e.target.parentElement).index()].value).IsSelected=!0}),$(document).on("click","#use-source-name, #advanced-source-name",function(e){if("use-source-name"===e.target.getAttribute("id")||"advanced-source-name"===e.target.getAttribute("id"))updateReportName();else{var t=angular.element("[ng-controller=PublishCtrl]").scope();$.each(t.targetSiteDetail,function(e,a){t.activeMenu.SiteIdentifier==a.SiteIdentifier&&(a.UseSourceItemName?$("#advanced-dashboard-name").val(publishedDashboardInfo.Name):$("#advanced-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now()),a.PublishItem.Name=$("#advanced-dashboard-name").val().trim())})}}),$(document).on("change","input","textarea",function(){resetAngularEvent=!0}),$(document).on("keyup focusout","#active-sites-dropdown",function(e){$("#active-sites-dropdown li.selected").length>0?($("#active-sites-dropdown .bootstrap-select .selectpicker").removeClass("has-error"),$("#add-external-sites .btn.btn-default").removeClass("has-error"),$("#active-sites-validation").html("")):($("#active-sites-validation").html(window.Server.App.LocalizationContent.SelectSites),$("#active-sites-dropdown .bootstrap-select .selectpicker").addClass("has-error"),$("#add-external-sites .btn.btn-default").addClass("has-error")),activateSubmit()}),$(document).on("keyup focusout","#publish-category-name",function(e){var t=$("#publish-category-name").val().trim();parent.isEmptyOrWhitespace(t)?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.LocalizationContent.Categoryvalidator),$("#publish-category-name").addClass("has-error")):parent.IsValidName("name",t)?($("#publish-category-name").removeClass("has-error"),$("#publish-category-validation").html(""),$("#publish-plugin-validation").html("")):($("#publish-plugin-validation").html(""),$("#publish-category-validation").html(window.Server.App.LocalizationContent.AvoidSpecialCharactors),$("#publish-category-name").addClass("has-error")),activateSubmit()}),$(document).on("keyup focusout","#advanced-category-name",function(e){var t=$("#advanced-category-name").val().trim();parent.isEmptyOrWhitespace(t)?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.LocalizationContent.ItemNameValidator),$("#advanced-category-name").addClass("has-error")):parent.IsValidName("name",t)?($("#advanced-category-name").removeClass("has-error"),$("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html("")):($("#advanced-plugin-validation").html(""),$("#advanced-category-validation").html(window.Server.App.LocalizationContent.AvoidSpecialCharactors),$("#advanced-category-name").addClass("has-error")),activateSubmit()});var isExternalSitesDialogBinded=!1;function isSiteNameExist(e){return!$("#external-site-name").hasClass("has-error")}function getExternalSitesDetailDialog(){var e='<span class ="external-sites-dialog-header">'+window.Server.App.LocalizationContent.ExternalSiteDialogHeader+"</span>";if(isExternalSitesDialogBinded){ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),(t=document.getElementById("external-site-dialog").ej2_instances)[0].show()}else{var t,a=document.createElement("div");a.setAttribute("id","external-site-dialog"),document.getElementById("dashboard-page-container").appendChild(a),(t=new ejs.popups.Dialog({header:e,content:document.getElementById("get-external-site-content"),buttons:[{click:function(e){$("#dialog-container").valid()&&!parent.$("#external-client-id, #external-client-secret, #external-site-url, #external-site-name").hasClass("has-error")?saveExternalSites():e.preventDefault()},buttonModel:{isPrimary:!0,content:window.Server.App.LocalizationContent.SaveButton}},{click:function(){t.hide()},buttonModel:{content:window.Server.App.LocalizationContent.CancelButton}}],animationSettings:{effect:"Zoom"},beforeOpen:beforeOpenExternalSitesDialog,beforeClose:beforeCloseExternalSitesDialog,width:"600px",showCloseIcon:!0,isModal:!0})).appendTo(a),isExternalSitesDialogBinded=!0,ejs.popups.createSpinner({target:document.getElementById("external-site-dialog")}),ejs.popups.setSpinner({type:"Material"})}}function beforeOpenExternalSitesDialog(){$("#get-external-site-content").show(),$("#external-client-id").parent("div").removeClass("has-error"),$("#external-client-secret").parent("div").removeClass("has-error"),$("#external-site-url").parent("div").removeClass("has-error"),$(".client-secret-validation-message, .clientid-validation-message, .site-url-validation-message, .name-validation-message").html(""),parent.$("#external-client-id, #external-client-secret, #external-site-url, #external-site-name").removeClass("has-error")}function beforeCloseExternalSitesDialog(){$("#external-client-id, #external-client-secret, #external-site-url, #external-site-name").val(""),$(".client-secret-validation-message, .clientid-validation-message, .site-url-validation-message, .name-validation-message").html(""),parent.$("#external-client-id, #external-client-secret, #external-site-url, #external-site-name").removeClass("has-error")}function updateExternalSites(){$.ajax({type:"GET",data:{itemId:publishedDashboardInfo.Id},url:getExternalSitesUrl,success:function(e){if(e.Status){var t=angular.element("[ng-controller=PublishCtrl]").scope();if($.each(e.Result,function(e,a){t.activeSites.push({TenantId:a.ClientId.toLowerCase(),SiteIdentifier:"",TenantName:a.Name}),a.IsPublished?$("#multiselect-dropdown").append("<option id="+a.ClientId.toLowerCase()+' value="" disabled>'+a.Name+"</option>"):$("#multiselect-dropdown").append("<option id="+a.ClientId.toLowerCase()+' value="" >'+a.Name+"</option>")}),0==e.Result.length&&$("#multiselect-dropdown").append('<option class = "no-sites" disabled>'+window.Server.App.LocalizationContent.NoActiveSites+"</option>"),$("#multiselect-dropdown").selectpicker("refresh"),$.each(e.Result,function(e,t){if(!t.IsPublished){var a=null!=t.DNS?t.DNS:t.SiteURL;$("#active-sites-dropdown .dropdown-menu .inner li").eq(e).attr("data-bs-toggle","tooltip").attr("data-original-title","<span class='tooltip-row'><span class='tooltip-label'>URL: </span><span class='tooltip-description'>"+a+"</span></span>").attr("data-bs-placement","right").attr("data-html","true")}}),$('#publish-site-dialog [data-bs-toggle="tooltip"]').tooltip({delay:{show:500},container:$("#publish-site-dialog")}),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem(),$("#external-site-dialog").length>0)document.getElementById("external-site-dialog").ej2_instances[0].hide()}}})}function saveExternalSites(){var e={Name:$("#external-site-name").val().trim(),ClientId:$("#external-client-id").val().trim(),ClientSecret:$("#external-client-secret").val().trim(),SiteURL:$("#external-site-url").val().trim()};ejs.popups.showSpinner(document.getElementById("external-site-dialog")),$.ajax({type:"POST",url:addExternalSitesUrl,data:{externalSite:e},success:function(e){if(e.Status){if(e.Data)return $(".name-validation-message").html(window.Server.App.LocalizationContent.SiteNameExist),parent.$("#external-site-name").addClass("has-error"),void ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));if(!e.Result)return $(".site-url-validation-message").html(window.Server.App.LocalizationContent.ExternalSiteUnavailable),parent.$("#external-site-url").addClass("has-error"),void ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));$("#multiselect-dropdown").empty(),$("#multiselect-dropdown").selectpicker("refresh"),angular.element("[ng-controller=PublishCtrl]").scope().activeSites=[],updateExternalSites(),SuccessAlert(window.Server.App.LocalizationContent.ExternalSiteDialogHeader,window.Server.App.LocalizationContent.ExternalSiteSuccess,7e3)}else{ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),WarningAlert(window.Server.App.LocalizationContent.ExternalSiteDialogHeader,window.Server.App.LocalizationContent.ExternalSiteFailure,7e3),document.getElementById("external-site-dialog").ej2_instances[0].hide()}}})}function siteNameCheck(e){$.ajax({type:"POST",url:isSiteNameExistsUrl,data:{siteName:e},success:function(e){e.Status?($(".name-validation-message").html(window.Server.App.LocalizationContent.SiteNameExist),parent.$("#external-site-name").addClass("has-error")):($(".name-validation-message").html(""),parent.$("#external-site-name").removeClass("has-error"))}})}function deleteConfirmation(e){setTimeout(function(){var t=$("#ConnectedSitesGrid").data("ejGrid"),a=t.getCurrentViewData()[t.getIndexByRow($("tr.e-row[aria-selected *='true']"))];messageBox("su-delete",window.Server.App.LocalizationContent.DeleteConnectedSite,window.Server.App.LocalizationContent.DeleteSiteConfirm+'<span class ="highlight-name">'+a.Name+" ?</span>","error",function(){var t=createLoader("messageBox_wrapper");$("#messageBox_wrapper").ejWaitingPopup({template:$("#"+t)}),$("#messageBox_wrapper").css("height",$("#messageBox").outerHeight()),$("#messageBox_wrapper").ejWaitingPopup("show"),removeExternalSite(e)})},100)}function removeExternalSite(e){var t=$(e).attr("data-id");$.ajax({type:"POST",url:removeExternalSiteUrl,data:{id:t},success:function(e){e.Status?(getExternalSites(),SuccessAlert(window.Server.App.LocalizationContent.DeleteConnectedSite,window.Server.App.LocalizationContent.DeleteSiteSuccess,7e3)):WarningAlert(window.Server.App.LocalizationContent.DeleteConnectedSite,window.Server.App.LocalizationContent.DeleteSiteFailure,7e3),$("#messageBox_wrapper").ejWaitingPopup("hide"),onCloseMessageBox()}})}function getExternalSites(){$("#ConnectedSitesGrid").ejWaitingPopup("show"),$.ajax({type:"GET",url:getExternalSitesUrl,success:function(e){e.Status&&$("#ConnectedSitesGrid").data("ejGrid").dataSource(e.Result);$("#ConnectedSitesGrid").ejWaitingPopup("hide")}})}function isValidUrl(e){return/^(https?|ftp):\/\/[^\/\s]+(:\d+)?(\/[^\s\/]+)*\/?$/.test(e)}function extractXSRFTokenFromCookie(){var e=parent.document.cookie.split("; ").find(e=>e.startsWith("XSRF-TOKEN="));return e?e.split("=")[1]:null}function setXSRFRequestHeader(e){e.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function EscapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}$(document).ready(function(){$.validator.addMethod("isRequired",function(e,t){return!isEmptyOrWhitespace(e)},window.Server.App.LocalizationContent.ItemNameValidator),$.validator.addMethod("isValidName",function(e,t){return IsValidName("name",e)},window.Server.App.LocalizationContent.AvoidSpecialCharactors),$.validator.addMethod("additionalSpecialCharValidation",function(e,t){if(/^[a-zA-Z_0-9`~!\$\^()=\-\.\{\} ]+$/.test(e)||""===e)return!0},window.Server.App.LocalizationContent.AvoidSpecialCharactors),$.validator.addMethod("isSiteNameValid",function(e,t){return isSiteNameExist(e)},window.Server.App.LocalizationContent.SiteNameExist),$.validator.addMethod("isValidUrl",function(e,t){return isValidUrl(e)},window.Server.App.LocalizationContent.IsValidUrl),$("#dialog-container").validate({errorElement:"span",onkeyup:function(e,t){9!=t.keyCode&&(isKeyUp=!0,$(e).valid(),isKeyUp=!1)},onfocusout:function(e){$(e).valid()},rules:{"external-site-name-input":{isRequired:!0,isValidName:!0,isSiteNameValid:!0,additionalSpecialCharValidation:!0},"external-client-id-input":{isRequired:!0},"external-client-secret-input":{isRequired:!0},"external-site-url-input":{isRequired:!0,isValidUrl:!0}},highlight:function(e){$(e).closest("div").addClass("has-error")},unhighlight:function(e){$(e).closest("div").removeClass("has-error"),$(e).closest("div").find("span").html("")},errorPlacement:function(e,t){$(t).closest("div").find("span").html(e.html()).show()},messages:{"external-site-name-input":{isRequired:window.Server.App.LocalizationContent.ItemNameValidator},"external-client-id-input":{isRequired:window.Server.App.LocalizationContent.ClientId},"external-client-secret-input":{isRequired:window.Server.App.LocalizationContent.ClientSecret},"external-site-url-input":{isRequired:window.Server.App.LocalizationContent.SiteURL}}})}),$(document).on("keyup focusout","#external-site-name",function(e){var t=$("#external-site-name").val().toLowerCase().trim();"focusout"===e.type?isNullOrWhitespace(t)||siteNameCheck(t):(isNullOrWhitespace(t)||($(".name-validation-message").html(""),parent.$("#external-site-name").removeClass("has-error")),$("[name='external-site-name-input']").valid())}),$(document).on("focusout","#external-site-url",function(e){$("#validation-message").html("").hide();var t=$("#external-site-url").val().toLowerCase().trim();isNullOrWhitespace(t)||isValidUrl(t)&&($("#external-site-url").closest("div").removeClass("has-error"),$("#external-site-url").removeClass("has-error"))}),$(document).on("click","#get-external-sites-detail",getExternalSitesDetailDialog),$(document).on("mousedown",".show-hide-password",function(){$(this).siblings("input").is(":password")&&$(this).siblings("input").attr("type","text")}),$(document).on("mouseleave",".show-hide-password",function(){$(this).siblings("input").attr("type","password")}),$.ajaxSetup({beforeSend:function(e){setXSRFRequestHeader(e)}});
