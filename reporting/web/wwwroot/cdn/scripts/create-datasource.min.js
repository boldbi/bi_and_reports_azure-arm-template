function showEJ2Spinner(e){ejs.popups.showSpinner($(e)[0])}function hideEJ2Spinner(e){ejs.popups.hideSpinner($(e)[0])}function renderEJ2Textbox(e,t){if(null==e.ej2_instances){new ejs.inputs.TextBox({width:t}).appendTo(e)}}function createEJ2Spinner(e){ejs.popups.createSpinner({target:$(e)[0],cssClass:"e-spin-overlay"})}function renderEJ2Button(e,t){new ejs.buttons.Button({isPrimary:t}).appendTo(e)}let toastInstance,connectorListScope,connectorScope,createDataSourceApp=angular.module("createDataSourceApp",["ejangular"]);function initializeToastControl(){toastInstance=new ejs.notifications.Toast({title:window.Server.App.LocalizationContent.Success+"!",content:window.Server.App.LocalizationContent.CreateDatasourceSuccess,target:document.body,cssClass:"e-toast-success",timeOut:1e3,close:function(){toastInstance.toastCloseCb()},position:{X:"Right",Y:"Top"},showCloseButton:!0,newestOnTop:!0,animation:{hide:{effect:"SlideRightOut"},show:{effect:"SlideRightIn"}}}),toastInstance.appendTo(".dc-toast")}function showToast(e){toastInstance.show(),toastInstance.toastCloseCb=e}function dialogShow(){var e=$("#dataDesigner").data("boldReportDesigner");e&&e.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.CancelDlgTitle,window.Server.App.LocalizationContent.CancelDlgContent,!0,!1,!0,"",{method:"onAlertYesBtnClick",instance:this})}function onAlertYesBtnClick(e){if(e){var t=angular.element(document.getElementsByClassName("cd-container")).scope();t.$apply(function(){t.changeDataConnector(void 0)})}}function onFocus(){angular.element(".e-input-group.e-control-wrapper.dc-filter-autocomplete").addClass("e-input-focus")}function onBlur(){angular.element(".e-input-group.e-control-wrapper.dc-filter-autocomplete").removeClass("e-input-focus")}function initializeDataSetFormTooltip(){let e=new ejs.popups.Tooltip({content:"valudescription",target:".e-rptdesigner-error-icon",position:"LeftBottom",offsetX:1,offsetY:-12,cssClass:"e-rpt-label-tooltip",windowCollision:!0,showTipPointer:!1,animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});e.beforeOpen=function(t){if(t.event&&t.event.target){let n=t.event.target;e.content=$(n).attr("data-title"),e.refresh(n)}},e.appendTo($(".dataset-form-container")[0])}createDataSourceApp.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]),createDataSourceApp.service("ajaxService",["$http","$q",function(e,t){let n,o=!1;return{get:function(r){return o&&n.resolve(),o=!0,n=t.defer(),e({method:"get",url:r,timeout:n.promise}).then(i,a)},postQueryData:function(t,n){return e({method:"post",url:t,data:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(i,a)},cancelRequest:function(){o&&n.resolve()}};function a(e){return angular.isObject(e.data)&&e.data.message?t.reject(e.data.message):t.reject(window.Server.App.LocalizationContent.UnknownError)}function i(e){return e.data}}]),$(document).ready(function(){initializeToastControl()}),showEJ2Spinner(".cd-container"),createDataSourceApp.controller("createDataSourceCtrl",["$scope",function(e){e.datasetCreation=!1,e.selectedDataConnector=void 0,e.updateDataSetCreation=function(t){e.datasetCreation=t},e.changeDataConnector=function(t){e.selectedDataConnector=t}}]),createDataSourceApp.controller("connectDataHeaderCtrl",["$scope",function(e){e.onBackBtnClick=function(){dialogShow()},e.onCloseBtnClick=function(){parent.window.location.href=datasource}}]),createDataSourceApp.controller("connectorListCtrl",["$scope","$window","$timeout","ajaxService",function(e,t,n,o){connectorListScope=e,e.loadingStatus=!1,e.filterTimeout=void 0,e.connectorList=[],e.dataList=[],e.categories=[],e.searchText="",e._CryptoAES=window.CryptoJS,e._key=e._CryptoAES.enc.Utf8.parse(keyCode),e._iv=e._CryptoAES.enc.Utf8.parse(ivCode),(e.onConnertorListResize=function(){angular.element(".cd-connector-list").css("height",window.innerHeight-angular.element(".cd-header-container").height())})(),angular.element(".cd-connector-list").css("height",window.innerHeight-angular.element(".cd-header-container").height());let a=new ejs.popups.Tooltip({content:"valudescription",target:".dc-list-info",position:"RightBottom",windowCollision:!0,offsetY:-10,cssClass:"e-rpt-label-tooltip",animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});a.beforeOpen=function(e){a.content=angular.element(e.event.target).attr("data-title"),a.dataBind()},a.appendTo(angular.element(".dc-list")[0]);let i=new ejs.dropdowns.DropDownList({dataSource:[],fields:{text:"displayName"},cssClass:"dc-filter-ddl-wrapper",width:"200px",height:"28px",value:"All Categories"});i.change=function(t){e.filterTimeout=n(function(){e.connectorList=e.filterConnectorList(e.searchText,t.value)},200)},i.dataBound=function(){angular.element(".dc-filter-ddl")[0].ej2_instances[0].value="All Categories",angular.element(".dc-filter-ddl")[0].ej2_instances[0].dataBind(),n(function(){angular.element(".dc-list-cards").addClass("dc-animate"),hideEJ2Spinner(".cd-container")})},i.appendTo(angular.element(".dc-filter-ddl")[0]),e.onAutocompleteTailClick=function(t){t.currentTarget.classList.contains("dc-delete")&&(e.searchText="")},angular.element(t).on("resize",function(){e.onConnertorListResize()}),e.onDataListHover=function(e){e.currentTarget.querySelector(".dc-list-img").classList.toggle("e-hover")},e.onDataConnectorSelect=function(t){e.$parent.changeDataConnector(t)},e.$on("$destroy",function(){window.angular.element(t).off("resize")}),e.$watch("searchText",function(t){e.filterTimeout&&n.cancel(e.filterTimeout),e.filterTimeout=n(function(){e.connectorList=e.filterConnectorList(t,angular.element(".dc-filter-ddl")[0].ej2_instances[0].value)},200)}),e.filterConnectorList=function(t,n){return e.dataList&&e.dataList.length?e.dataList.filter(function(e){return!("All Categories"!==n&&e.category!==n||t.toLowerCase()&&-1===e.displayName.toLowerCase().indexOf(t.toLowerCase()))}):[]},e.datasourceCallback=function(t){availableDSList=e.sortCollection(t,"name"),e.doAjaxRequest("GET",getDataConnectors,{},$.proxy(e.getConnectionInfo,this))},e.convertTilesInfoFormat=function(e){for(var t=!ej.isNullOrUndefined(connectionList)&&connectionList.length>0?connectionList:[],n=[],o=0;o<e.length;o++){var a=e[o],i=ej.isNullOrUndefined(a.category)?"Rest":a.category;(0===t.length||-1!==t.indexOf(a.connector))&&n.push({id:a.id,iconClassName:a.src+"-tile",category:i,itemType:a.itemType,extType:a.extType,displayName:a.name,connector:a.connector,description:a.description})}return n},e.initializeDesigner=function(){var t={serviceUrl:serviceURL,reportServerUrl:serverURL,isAzureApp:isAzureApplication,serviceAuthorizationToken:designerToken,ajaxBeforeLoad:e.ajaxBeforeSend,encryptData:e.encryptData,decryptData:e.decryptData,customBrandSettings:{hideHelpLink:isHideHelpLink,customDomain:customDomain,customBrandName:custombrandName,customLinks:window.customLinks}};designerInstance=new boldReportDesigner($("#designer"),t)},(getConnectorList=function(){var t=$.proxy(e.datasourceCallback,this);e.initializeDesigner(),designerInstance.getDataConnectorsInfo(t,null)})(),e.getConnectionInfo=function(t){t&&t.status&&t.data&&(connectionList=t.data.connectionList),e.dataList=e.convertTilesInfoFormat(availableDSList),e.connectorList=e.dataList;var n=[];e.connectorList.filter(function(e){n.push(e.category)});var o=[];$.each(n,function(e,t){-1==$.inArray(t,o)&&o.push(t)}),e.categories.push({displayName:"All Categories"});for(var a=0;a<o.length;a++)e.categories.push({displayName:o[a]});angular.element(".dc-filter-ddl")[0].ej2_instances[0].dataSource=e.categories,angular.element(".dc-filter-ddl")[0].ej2_instances[0].dataBind(),e.loadingStatus=!0,e.$apply()},e.doAjaxRequest=function(t,n,o,a){$.ajax({type:t,url:n,data:o,beforeSend:function(t){t.setRequestHeader("ServerUrl",serverURL),t.setRequestHeader("serviceAuthorizationToken",designerToken),e._setRequestHeader(t)},success:function(e){e&&ej.ReportUtil.invokeCallBack(a,e)},error:function(){ej.ReportUtil.invokeCallBack(a,null)}})},e.sortCollection=function(e,t){return e.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0})},e._setRequestHeader=function(e){e&&e.setRequestHeader("encryptionKey",encryptionKey)},e._encryptData=function(t){return e._CryptoAES.AES.encrypt(e._CryptoAES.enc.Utf8.parse(t),_key,{keySize:16,iv:_iv,mode:e._CryptoAES.mode.CBC,padding:e._CryptoAES.pad.Pkcs7}).toString()},e._decryptData=function(t){return e._CryptoAES.AES.decrypt(t,_key,{keySize:16,iv:_iv,mode:e._CryptoAES.mode.CBC,padding:e._CryptoAES.pad.Pkcs7}).toString(e._CryptoAES.enc.Utf8)},e.encryptData=function(t){t&&t.data&&(t.data=e._encryptData(t.data))},e.decryptData=function(t){t&&t.data&&(t.data=e._decryptData(t.data))},e._injectKeys=function(e){e&&e.headers&&e.headers.push({Key:"encryptionKey",Value:encryptionKey})},e.ajaxBeforeSend=function(t){e._injectKeys(t)}}]),$(document).on("focus","#search-connectors",onFocus),$(document).on("blur","#search-connectors",onBlur),createEJ2Spinner(".cd-container"),createDataSourceApp.controller("connectorCtrl",["$scope","ajaxService",function(e,t){connectorScope=e,e.isCustomExtension="e-custom"===e.selectedDataConnector.itemType,angular.element(".dc-header").text(e.selectedDataConnector.displayName);let n=new ejs.popups.Tooltip({content:"valudescription",target:".dc-description-img",position:"RightBottom",offsetY:-10,cssClass:"e-rpt-label-tooltip",windowCollision:!0,animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});n.beforeOpen=function(t){n.content="Connect To "+e.selectedDataConnector.description,n.dataBind()},n.appendTo(angular.element(".dc-header-container")[0]),e.updateDataContainerHeight=function(){angular.element(".dc-container").css("height",window.innerHeight-angular.element(".cd-header-container").height()-angular.element(".cd-footer-container").height())},e.updateDesignerContainerHeight=function(){return window.innerHeight-(angular.element(".data-designer-container")[0].getBoundingClientRect().top-angular.element(".cd-header-container")[0].getBoundingClientRect().top)-angular.element(".cd-footer-container").height()-24},angular.element(".data-designer-container").css("height",e.updateDesignerContainerHeight()),window.addEventListener("resize",e.updateDataContainerHeight),e.dataSourceName="",e.resizeTO=void 0,e.reportDataExtensions=dataExtensions,e._CryptoAES=window.CryptoJS,e._key=e._CryptoAES.enc.Utf8.parse(keyCode),e._iv=e._CryptoAES.enc.Utf8.parse(ivCode),initializeDataSetFormTooltip(),e.onAjaxBeforeLoad=function(e){e&&e.headers&&e.headers.push({Key:"encryptionKey",Value:encryptionKey})},e.encryptData=function(t){t&&t.data&&(t.data=e._CryptoAES.AES.encrypt(e._CryptoAES.enc.Utf8.parse(t.data),e._key,{keySize:16,iv:e._iv,mode:e._CryptoAES.mode.CBC,padding:e._CryptoAES.pad.Pkcs7}).toString())},e.decryptData=function(t){t&&t.data&&(t.data=e._CryptoAES.AES.decrypt(t.data,e._key,{keySize:16,iv:e._iv,mode:e._CryptoAES.mode.CBC,padding:e._CryptoAES.pad.Pkcs7}).toString(e._CryptoAES.enc.Utf8))},e.onDesignerCreate=function(){this.model.filterDataConnectors=window.connectionList,this.dataExtensions=designerInstance.dataExtensions,this.builtInExts=designerInstance.builtInExts,this.isOnPremiseMode=window.isSelfHosted,this.dataSource.renderContainer($(".dataContainer")),e.renderDescription.call(this),this.dataSource.configTable.data("selected",e.selectedDataConnector.itemType),this.dataSource.configTable.data("selectedExt",e.selectedDataConnector.extType),this.dataSource.createData(e.selectedDataConnector.itemType,e.selectedDataConnector.extType);let t=e.isCustomExtension?this.extensiondataSource:this.dataSource;t.validateConnection=function(t,n){$(".dataContainer").find(".e-rptdesigner-error").length||(e.isCustomExtension?e.connectionResult(t,n,this):e.connectionResult(this.constructCon(),t,this))},t.showIndicator=function(){showEJ2Spinner(".cd-container")},t.hideIndicator=function(){hideEJ2Spinner(".cd-container")}},e.renderDescription=function(){let e=this._id+"_datasource_descname";this.dataSource.renderTextArea(window.Server.App.LocalizationContent.Description,e,$("table.e-rptdesigner-dsconfig-table")),$("#"+e).attr("maxlength",1024),$("#"+e+"_td").append('<div class="descname-info">* '+window.Server.App.LocalizationContent.MaxNoOfCharacters+"</div>")},e.testConnection=function(t){e.dataDesigner.dataSource.connectionCallBack=t,e.dataDesigner.dataSource.connectDatasource()},e.showValidationMsg=function(e,t,n){let o=$("#"+e+"_error_icon_td"),a=$("#"+e+"_td").find(".e-designer-content-label");t?(ej.ReportUtil.showErrIndictor(o,!0,n),a.addClass("e-rptdesigner-error")):(ej.ReportUtil.showErrIndictor(o,!1),a.removeClass("e-rptdesigner-error"))},e.saveDataSource=function(n){let o={Name:$("#dataDesigner_datasource_dsname").val(),Description:$("#dataDesigner_datasource_descname").val()};t.postQueryData(saveURL,{conString:JSON.stringify(n),dataSourceDetail:JSON.stringify(o)}).then(function(t){hideEJ2Spinner(".cd-container"),t.error?e.dataDesigner.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.DataConnector,t.error,!1,!0,!1,window.Server.App.LocalizationContent.DataFailure):t.result.IsNameExist?e.showValidationMsg("dataDesigner_datasource_dsname",!0,window.Server.App.LocalizationContent.IsDataSourceExist):(e.dataSourceName=n.Name,e.dataDesigner.dataSource.connectionCallBack(!0))})},e.getEmbeddedData=function(e){if(e.ConnectionProperties){let t={};return e.ConnectionProperties.EmbeddedData&&(t.ConcEmbeddedData=e.ConnectionProperties.EmbeddedData),e.ConnectionProperties.SSHConnectionSettings&&e.ConnectionProperties.SSHConnectionSettings.EmbeddedData&&(t.SSHConcEmbeddedData=e.ConnectionProperties.SSHConnectionSettings.EmbeddedData),e.ConnectionProperties.SSLConnectionSettings&&e.ConnectionProperties.SSLConnectionSettings.EmbeddedData&&(t.SSLConcEmbeddedData=e.ConnectionProperties.SSLConnectionSettings.EmbeddedData),t}return null},e.setEmbeddedData=function(e,t){t&&Object.keys(t).length>0&&e.ConnectionProperties&&(t.ConcEmbeddedData&&e.ConnectionProperties.EmbeddedData&&(e.ConnectionProperties.EmbeddedData.Data=t.ConcEmbeddedData),t.SSHConcEmbeddedData&&e.ConnectionProperties.SSHConnectionSettings&&e.ConnectionProperties.SSHConnectionSettings.EmbeddedData&&(e.ConnectionProperties.SSHConnectionSettings.EmbeddedData.Data=t.SSHConcEmbeddedData),t.SSLConcEmbeddedData&&e.ConnectionProperties.SSLConnectionSettings&&e.ConnectionProperties.SSLConnectionSettings.EmbeddedData&&(e.ConnectionProperties.SSLConnectionSettings.EmbeddedData.Data=t.SSLConcEmbeddedData))},e.connectionResult=function(t,n,o){if("true"===n){showEJ2Spinner(".cd-container");let n=e.getEmbeddedData(t);n&&Object.keys(n).length>0?e.dataDesigner.getInstance("ReportUtil").doAjaxPost("POST",ej.ReportUtil.getTenantUrl(e.dataDesigner.model.serviceUrl+"/PostDesignerAction/",e.dataDesigner.model.tenantName),{action:"EmbeddedData",data:JSON.stringify({designerAction:"EmbeddedData",embeddedDataInfo:n})},{fnction:function(n){"string"==typeof n&&-1!==n.indexOf("Sf_Exception")?e.dataDesigner.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.DataConnector,n,!1,!0,!1,window.Server.App.LocalizationContent.EmbeddeddDataFailure):(e.setEmbeddedData(t,n),e.saveDataSource(t))},indicator:[null,null]}):e.saveDataSource(t)}else o.reportDesigner.getInstance("ReportUtil").ejAlertDialog(o.getLocale("alertLabel"),n,!1,!0,!1,o.getLocale("alertConnectionFailed"),{})},e.$on("$destroy",function(){window.removeEventListener("resize",e.updateDataContainerHeight)})}]);let validateDataSetForm=function(e,t){hideDataSetFormValidation();let n=$(".dataset-form-name").val(),o=!0;n.length?isSpecialCharacter(n)&&(o=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.AvoidSpacesAndSpecialCharacters)):(o=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.DatasetNameValidation)),o?e.postQueryData(isDataSetExistUrl,{dataSetName:n}).then(function(e){e.Data&&toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.DatasetNameAlreadyExist),t(!e.Data)}):t(o)},hideDataSetFormValidation=function(){toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"))},toggleDataSetFormValidationMsg=function(e,t,n){t=void 0!==t&&t,e.find(".e-rptdesigner-error-icon").css("display",t?"block":"none"),e.find(".e-designer-content-label")[t?"addClass":"removeClass"]("e-rptdesigner-error"),n&&e.find(".e-rptdesigner-error-icon").attr("data-title",n)};function isSpecialCharacter(e){return new RegExp(/[!"#$%&'()*+,\s./:;<=>?@[\\\]^`{|}~-]/g).test(e)}function extractXSRFTokenFromCookie(){var e=parent.document.cookie.split("; ").find(e=>e.startsWith("XSRF-TOKEN="));return e?e.split("=")[1]:null}function setXSRFRequestHeader(e){e.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function EscapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}createDataSourceApp.controller("connectDataFooterCtrl",["$scope","ajaxService",function(e,t){e.onSaveBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){parent.window.location.href=datasource})})},e.onDataSetBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){e.onDataSetCreate(),e.$applyAsync()})}),renderEJ2Textbox($(".dataset-form-name")[0],430),renderEJ2Textbox($(".dataset-form-desc")[0],430)},e.onProceedBtnClick=function(){showEJ2Spinner(".cd-container"),validateDataSetForm(t,function(e){e&&($(".dataset-form").submit(),parent.window.location.href=datasource),hideEJ2Spinner(".cd-container")})},e.onDataSetCreate=function(){e.$parent.updateDataSetCreation(!0)}}]),renderEJ2Button(angular.element(".cd-footer-dataset-btn")[0],!0),renderEJ2Button(angular.element(".cd-footer-save-btn")[0],!1),renderEJ2Button(angular.element(".cd-footer-connect-btn")[0],!0),$.ajaxSetup({beforeSend:function(e){setXSRFRequestHeader(e)}});
