function showEJ2Spinner(e){ejs.popups.showSpinner($(e)[0])}function hideEJ2Spinner(e){ejs.popups.hideSpinner($(e)[0])}function renderEJ2Textbox(e,t){if(null==e.ej2_instances){new ejs.inputs.TextBox({width:t}).appendTo(e)}}function createEJ2Spinner(e){ejs.popups.createSpinner({target:$(e)[0],cssClass:"e-spin-overlay"})}function renderEJ2Button(e,t){new ejs.buttons.Button({isPrimary:t}).appendTo(e)}let toastInstance,dataSetScope,createDataSetApp=angular.module("createDataSetApp",[]);function initializeToastControl(){toastInstance=new ejs.notifications.Toast({title:window.Server.App.LocalizationContent.Success+"!",content:window.Server.App.LocalizationContent.CreateDatasourceSuccess,target:document.body,cssClass:"e-toast-success",timeOut:1e3,close:function(){toastInstance.toastCloseCb()},position:{X:"Right",Y:"Top"},showCloseButton:!0,newestOnTop:!0,animation:{hide:{effect:"SlideRightOut"},show:{effect:"SlideRightIn"}}}),toastInstance.appendTo(".ds-toast")}function showToast(e){toastInstance.show(),toastInstance.toastCloseCb=e}function closePopup(){parent.$(".cds-iframe").attr("src",""),parent.$(".cds-popup").ejDialog("close")}function onFocus(){angular.element(".e-input-group.e-control-wrapper.dc-filter-autocomplete").addClass("e-input-focus")}function onBlur(){angular.element(".e-input-group.e-control-wrapper.dc-filter-autocomplete").removeClass("e-input-focus")}function initializeDataSetFormTooltip(){let e=new ejs.popups.Tooltip({content:"valudescription",target:".e-rptdesigner-error-icon",position:"LeftBottom",offsetX:1,offsetY:-12,cssClass:"e-rpt-label-tooltip",windowCollision:!0,showTipPointer:!1,animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});e.beforeOpen=function(t){if(t.event&&t.event.target){let a=t.event.target;e.content=$(a).attr("data-title"),e.refresh(a)}},e.appendTo($(".dataset-form-container")[0])}createDataSetApp.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]),createDataSetApp.service("ajaxService",["$http","$q",function(e,t){let a,n=!1;return{get:function(i){return n&&a.resolve(),n=!0,a=t.defer(),e({method:"get",url:i,timeout:a.promise}).then(r,o)},postQueryData:function(t,a){return e({method:"post",url:t,data:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(r,o)},cancelRequest:function(){n&&a.resolve()}};function o(e){return angular.isObject(e.data)&&e.data.message?t.reject(e.data.message):t.reject(window.Server.App.LocalizationContent.UnknownError)}function r(e){return e.data}}]),$(document).ready(function(){initializeToastControl()}),createDataSetApp.controller("createDataSetCtrl",["$scope",function(e){e.useExistingDataSource=!1,e.isDataSourceList=!1,e.changeExistingDataSource=function(t){e.useExistingDataSource=t},e.updateIsDataSourceList=function(t){e.isDataSourceList=t}}]),createDataSetApp.controller("connectDataSetHeaderCtrl",["$scope",function(e){e.onCloseBtnClick=function(){parent.window.location.href=dataset}}]),createDataSetApp.controller("dataSetContainerCtrl",["$scope",function(e){e.dataSourceName=void 0,e.filterTimeout=void 0,e.updateDataSourceName=function(t){e.dataSourceName=t},e.$parent.updateIsDataSourceList(!0)}]),createEJ2Spinner(".ds-container"),createDataSetApp.controller("dataSetCtrl",["$scope","$timeout","ajaxService",function(e,t,a){dataSetScope=e,e.dataSourceList=[],e.dataList=[],(getDataSetList=function(){showEJ2Spinner(".ds-container"),angular.element(".e-waitpopup-pane ").css("background-color","transparent"),a.postQueryData(getDataSources,{}).then(function(t){e.dataList=t.result,e.dataSourceList=e.dataList.slice(),hideEJ2Spinner(".ds-container"),angular.element(".e-waitpopup-pane ").css("background-color","#383838")})})(),initializeDataSetFormTooltip(),e.updateDataSetContainerHeight=function(){angular.element(".ds-dataset").css("height",window.innerHeight-angular.element(".cds-header-container").height()-angular.element(".cds-footer-container").height())},e.updateScrollBar=function(){e.$parent.isDataSourceList?angular.element(".ds-datasource-lists").css("height",window.innerHeight-(angular.element(".ds-datasource-lists")[0].getBoundingClientRect().top-angular.element(".cds-header-container")[0].getBoundingClientRect().top)-angular.element(".cds-footer-container").height()-23):angular.element(".ds-container").css("height",window.innerHeight-(angular.element(".ds-dataset")[0].getBoundingClientRect().top-angular.element(".cds-header-container")[0].getBoundingClientRect().top)-angular.element(".cds-footer-container").height()-66)},e.updateScrollBar(),window.addEventListener("resize",e.updateDataSetContainerHeight),e.onDataSourceClick=function(t,a){let n=document.querySelector(".ds-datasource-list.ds-selected");n&&n.classList.remove("ds-selected"),t.currentTarget.classList.add("ds-selected"),e.$parent.updateDataSourceName(a)},e.onAutocompleteTailClick=function(t){t.currentTarget.classList.contains("ds-delete")&&(e.searchText="")},e.$watch("searchText",function(a){e.filterTimeout&&t.cancel(e.filterTimeout),e.filterTimeout=t(function(){e.dataSourceList=e.filterConnectorList(a?a.toLowerCase():a),e.dataSourceName&&-1===e.dataSourceName.toLowerCase().indexOf(a)&&e.$parent.updateDataSourceName(void 0)},200)}),e.filterConnectorList=function(t){return e.dataList&&e.dataList.length?e.dataList.filter(function(e){return!t||-1!==e.Name.toLowerCase().indexOf(t)}):[]},e.$on("$destroy",function(){window.removeEventListener("resize",e.updateDataContainerHeight)})}]),$(document).on("focus","#search-datasource",onFocus),$(document).on("blur","#search-datasource",onBlur),createDataSetApp.controller("DataSetCardCtrl",["$scope","$window",function(e,t){(e.onDataSetCardResize=function(){angular.element(".cds-card-container").css("height",window.innerHeight-angular.element(".cds-header-container").height())})(),e.onCreateDataSourceClick=function(){parent.window.location.href=createDatasource},e.onExistingDataSourceClick=function(){e.$parent.changeExistingDataSource(!0)},angular.element(t).on("resize",function(){e.onDataSetCardResize()}),e.$on("$destroy",function(){window.angular.element(t).off("resize")})}]);let validateDataSetForm=function(e,t){hideDataSetFormValidation();let a=$(".dataset-form-name").val(),n=!0;a.length?isSpecialCharacter(a)&&(n=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.AvoidSpacesAndSpecialCharacters)):(n=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.DatasetNameValidation)),n?e.postQueryData(isDataSetExistUrl,{dataSetName:a}).then(function(e){e.Data&&toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.DatasetNameAlreadyExist),t(!e.Data)}):t(n)},hideDataSetFormValidation=function(){toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"))},toggleDataSetFormValidationMsg=function(e,t,a){t=void 0!==t&&t,e.find(".e-rptdesigner-error-icon").css("display",t?"block":"none"),e.find(".e-designer-content-label")[t?"addClass":"removeClass"]("e-rptdesigner-error"),a&&e.find(".e-rptdesigner-error-icon").attr("data-title",a)};function isSpecialCharacter(e){return new RegExp(/[!"#$%&'()*+,\s./:;<=>?@[\\\]^`{|}~-]/g).test(e)}function extractXSRFTokenFromCookie(){var e=parent.document.cookie.split("; ").find(e=>e.startsWith("XSRF-TOKEN="));return e?e.split("=")[1]:null}function setXSRFRequestHeader(e){e.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function EscapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}createDataSetApp.controller("dataSetFooterCtrl",["$scope","ajaxService",function(e,t){e.onBackBtnClick=function(){e.$parent.changeExistingDataSource(!1)},e.onConnectBtnClick=function(){e.$parent.updateIsDataSourceList(!1),dataSetScope.updateScrollBar(),renderEJ2Textbox($(".dataset-form-name")[0],430),renderEJ2Textbox($(".dataset-form-desc")[0],430)},e.onDataSetFormBackBtnClick=function(){e.$parent.updateIsDataSourceList(!0)},e.onProceedBtnClick=function(){showEJ2Spinner(".cds-container"),validateDataSetForm(t,function(e){e&&($(".dataset-form").submit(),parent.window.location.href=dataset),hideEJ2Spinner(".cds-container")})}}]),renderEJ2Button(angular.element(".cds-footer-connect-btn")[0],!0),renderEJ2Button(angular.element(".cds-footer-proceed-btn")[0],!0),renderEJ2Button(angular.element(".cds-footer-back-btn")[0],!1),$.ajaxSetup({beforeSend:function(e){setXSRFRequestHeader(e)}});
