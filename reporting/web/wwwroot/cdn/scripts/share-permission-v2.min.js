var browser=ej.browserInfo();function intializeGetLinkDialog(){$.ajax({type:"Get",url:getLinkDialogViewUrl,data:{nonce:tileReportsPageNonce},success:function(e){$("body").append(e),$("#get_item_link").ejDialog({width:window.innerWidth>460?"450px":window.innerWidth-10,showOnInit:!1,allowDraggable:!1,enableResize:!1,height:"auto",title:window.Server.App.LocalizationContent.GetLink,showHeader:!1,enableModal:!0,closeOnEscape:!0,close:"onGetLinkDialogClose"});var o=createLoader("get_item_link_wrapper");$("#get_item_link_wrapper").ejWaitingPopup({template:$("#"+o)})}}),document.querySelectorAll('[data-bs-toggle="get-link-tooltip"]').forEach(e=>{new bootstrap.Tooltip(e,{animation:!0,html:!0,placement:"top"})})}function GetLink(e){var o=e.ItemType;3==o?$(".report-link").show():6==o?($(".file-link").show(),$("#compressed-link").prop("checked",!0)):8==o?$(".widget-link").show():$(".link").show();var t=e.Name;e.Id;$("#get_item_link").ejDialog("open"),$("#get_item_link").show(),$("#get_item_link_wrapper").ejWaitingPopup("show"),$(".get_link").show(),e.IsPublic?($(".private-note").hide(),$(".public-note").show()):($(".private-note").show(),$(".public-note").hide()),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)?($("#item-link-copy").removeClass("su su-copy"),$("#item-link-copy").hide(),$("#item-link").css({width:"100%",borderRadius:"4px"}),$("#item-link-copy").attr("data-bs-original-title","")):$("#item-link-copy").tooltip({animation:!1}),$(".report-name").html(t),$(".report-name").attr("title",t),$("#item-link").val(getDashboardShareLink(e.Id,e.CategoryName,e.Name)),$("#item-link").select(),$(".modal-footer .validation-area").css("display","block"),$("#get_item_link_wrapper").ejWaitingPopup("hide")}function onGetLinkDialogClose(){$("#get_item_link").ejDialog("close")}function onGetLinkDialogOpen(){$("#get_item_link").ejDialog("open"),$("#get_item_link").show(),$("#get_item_link").focus(),$("#item-link").select(),$(".get_link").show(),$("#item-link").val(itemUrl),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&($("#item-link-copy").removeClass("su su-copy"),$("#item-link-copy").hide(),$("#item-link-copy").attr("data-bs-original-title",""))}function getDashboardShareLink(e,o,t){var r=baseUrl.split("/");return encodeURI(r[0]+"//"+r[2]+viewDashboardUrlAction+"/"+e+"/"+o+"/"+t)}$(document).on("click","#item-link-copy",function(e){if($("#item-link").select(),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))$("#item-link-copy").removeClass("su su-copy"),$("#item-link-copy").attr("data-bs-original-title","");else{document.execCommand("copy");var o=document.querySelector("#item-link-copy"),t=bootstrap.Tooltip.getInstance(o);t&&t.dispose(),(t=new bootstrap.Tooltip(o,{title:window.Server.App.LocalizationContent.Copysuccess,trigger:"hover"})).show(),setTimeout(()=>{t.dispose(),t=new bootstrap.Tooltip(o,{title:window.Server.App.LocalizationContent.LinkCopy,trigger:"hover"})},1e3)}}),$(document).on("click","#get-link-dialog-close",function(e){e.preventDefault(),onGetLinkDialogClose()}),$(document).on("click","#Cancel",onGetLinkDialogClose),$(document).on("click","#item-link",function(){this.setSelectionRange(0,this.value.length)});var sharePermissionDlgObj="",sharePermissionDlgWrapperObj="",sharePermisisonDlgHeader="",sharePermissionDlgHeaderItemName="",sharePermissionConatiner="",accessModeContainer="",dummyContainer="",embedCodeContainer="",sharePermissionDashboardSettingSectionObj="",sharePermissionPublicSectionObj="",sharePermissionPrivateSectionObj="",sharePermissionUserGroupSectionObj="",manageUserGroupContainer="",manageUserGroupBodySection="",getEmbedLinkSection="",changeIndicatorBannerObj="",shareWithLabelObj="",getLinkInputObj="",getLinkCopyLinkobj="",getEmbedCodeInputObj="",getEmbedCodeCopyBtnobj="",accessModeChangeLink="",manageAccessButton="",manageAccessBackButton="",manageAccessSaveBtnObj="",manageAccessCancelBtnObj="",shareDoneBtnObj="",shareBtnObj="",accessModeChngBtnObj="",accessModeCancelBtnObj="",embedCodeDoneBtnObj="",addOwnerBtnObj="",publicRadioBtnObj="",privateRadioBtnObj="",isItemPublic=!1,isEntireDOMRendered=!1,accessModeSelectionInput="",sharedUserGroupsPreservedList=[],sharedAccessModePreservedList=[],markForDeleteBtnObj="",removeMarkForDeleteBtnObj="",toggleMarkForDeletionObj="",modifiedItemIndex=[],addNewItemPermission=[],userMarkedForDeletionList=[],groupMarkedForDeletionList=[],showSharedUserGroupContainer="",showSharedUserGroupNameSection="",showSharedUserGroupName="",showSharedUserGroupCountSection="",showSharedUserGroupCount="",currentItemDetail=[],shareItem=angular.module("sharePermission",[]);function sharePermission(e){$("#permission-popup iframe").attr("src",permissionIframeUrl+"?itemId="+e),$("#permission-popup").ejDialog("open"),ShowWaitingProgress("#permission-popup_wrapper","show")}function shareDashboardPermission(e,o){currentItemDetail=e,sharePermissionDlgHeaderItemName.text(currentItemDetail.Name),sharePermissionDlgObj.show();var t=null!=window.granularPermissions&&(window.granularPermissions.All||window.granularPermissions.ReportsSettings),r=null!=window.granularPermissions&&window.granularPermissions.Report,s=null!=window.granularPermissions&&window.granularPermissions.Dataset,i=null!=window.granularPermissions&&window.granularPermissions.Datasource,n=null!=window.granularPermissions&&window.granularPermissions.Category,a=angular.element("#share-permission-content-section").scope();switch(a.currentItemType=e.ItemType,a.isAdmin=isAdmin,a.hasDashboardSettingsPermission=isAdmin||t,$("#share-permission-popup_wrapper, #user-group-search-input_suggestion").addClass("custom-bootstrap-styles"),sharePermissionDlgObj.ejDialog("open"),e.ItemType==ItemType.Report&&(e.CreatedById==currentUserId||isAdmin||r)?(isMarkItemsPublic?e.IsPublic?showPublicContent():showPrivateContent():showDashboardSettingContent(),addAttributeValueToBtnEle(e)):hidePublicPrivateContent(),e.ItemType==ItemType.Report?e.CreatedById==currentUserId||isAdmin||r?(showShareUserGroupPermissionSection(),getShareItemPermission(e.Id),addAttributeValueToBtnEle(e),addAttributeValueToAutoCompleteEle(e)):hideShareUserGroupPermissionSection():e.ItemType==ItemType.Datasource?e.CreatedById==currentUserId||isAdmin||i?showShareDialogContent(e):hideShareUserGroupPermissionSection():e.ItemType==ItemType.Dataset?e.CreatedById==currentUserId||isAdmin||s?showShareDialogContent(e):hideShareUserGroupPermissionSection():e.ItemType==ItemType.Category?e.CreatedById==currentUserId||isAdmin||n?showShareDialogContent(e):hideShareUserGroupPermissionSection():e.CreatedById==currentUserId||isAdmin?showShareDialogContent(e):hideShareUserGroupPermissionSection(),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)?($("#item-url-copy").hide(),$("#item-url").css({width:"100%",borderRadius:"4px"}),$("#item-url-copy").attr("data-original-title","")):$("#item-url-copy").tooltip({animation:!1}),e.ItemType){case ItemType.Report:$("#item-url").val(getDashboardShareLink(e.Id,e.CategoryName,e.Name,e.UnlistedCode,e.IsUnlisted));break;case ItemType.ItemView:var c=getDashboardShareLink(o.Id,o.CategoryName,o.Name,null,!1);$("#item-url").val(c+"?viewid="+e.Id);break;default:$("#item-url").val("")}}function addGroupOwnerDialogOpen(){var e=$("#add-owner-button").attr("data-groupname"),o=$("#add-owner-button").attr("data-groupid"),t=angular.element("#share-permission-content-section").scope();currentItemDetail.ItemType=ItemType.UserManagement,t.currentItemType=ItemType.UserManagement,t.isAdmin=isAdmin,"undefined"!=typeof BoldBIDashboard?sharePermissionDlgObj.BoldBIDashboardDialog({height:241}):sharePermissionDlgObj.ejDialog({height:241}),sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.AddGroupOwnerBtn),sharePermissionDlgHeaderItemName.text(e),sharePermissionDlgObj.show(),$("#share-permission-popup_wrapper, #user-group-search-input_suggestion").addClass("custom-bootstrap-styles"),"undefined"!=typeof BoldBIDashboard?sharePermissionDlgObj.BoldBIDashboardDialog("open"):sharePermissionDlgObj.ejDialog("open"),hidePublicPrivateContent(),getGroupUserPermission(o),addOwnerBtnObj.attr("data-item-id",o),addOwnerBtnObj.attr("data-name",e),addOwnerBtnObj.attr("data-itemtype",ItemType.UserManagement),autoCompleteHiddenEle.attr("data-item-id",o),autoCompleteHiddenEle.attr("data-itemtype",ItemType.UserManagement)}function showShareDialogContent(e){showShareUserGroupPermissionSection(),getShareItemPermission(e.Id),addAttributeValueToBtnEle(e),addAttributeValueToAutoCompleteEle(e)}function onSharePermissionPopupOpen(e){$('[data-bs-toggle="popover"]').popover("hide"),sharePermissionDlgWrapperObj.ejWaitingPopup("refresh"),showSharePermissionContainer()}function onSharePermissionPopupClose(e){currentItemDetail=[],$(".embed-configuration [type='checkbox']").removeAttr("checked"),$('[data-bs-toggle="popover"]').popover("hide"),showSharePermissionContainer(),sharePermissionDlgWrapperObj.ejWaitingPopup("refresh"),sharePermissionDlgWrapperObj.ejWaitingPopup("hide"),refreshDialogBoxPosition()}function showAccessModeContainer(){sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.SharePermissionAccessMode),accessModeContainer.show(),accessModeChngBtnObj.show(),accessModeCancelBtnObj.show(),sharePermissionConatiner.hide(),manageAccessButton.hide(),shareBtnObj.hide(),shareDoneBtnObj.hide(),refreshDialogBoxPosition()}function showManageAccessContainer(){hidePublicPrivateContent(),showSharedUserGroupContainer.hide(),shareBtnObj.text(window.Server.App.LocalizationContent.AddPeopleBtn),addOwnerBtnObj.text(window.Server.App.LocalizationContent.AddPeopleBtn),sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.ManageAccess),dummyContainer.hide(),""==autoCompleteInstance.getValue()&&(shareBtnObj.hide(),addOwnerBtnObj.hide()),currentItemDetail.ItemType==ItemType.UserManagement&&($(".change-access-mode-selection span").removeClass("caret"),$(".change-access-mode-selection button").attr("disabled",!0)),manageAccessBackButton.show(),manageUserGroupContainer.show(),manageAccessButton.hide(),refreshUserGroupScroll(),refreshDialogBoxPosition(),generateProfileAvatar()}function hideManageAccessContainer(){manageUserGroupContainer.hide(),manageAccessSaveBtnObj.hide(),manageAccessCancelBtnObj.hide(),embedCodeDoneBtnObj.hide(),embedCodeContainer.hide(),changeIndicatorBannerObj.css("visibility","hidden"),resetPreRequestValues()}function showSharePermissionContainer(){currentItemDetail.ItemType==ItemType.UserManagement?(sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.AddGroupOwnerBtn),$(".show-shared-user-group-label").text("Group Owners :")):sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.SharePermissionDefault),dummyContainer.show(),shareBtnObj.text(window.Server.App.LocalizationContent.SharePeopleBtn),enableAutocompleteAccessModeSelectionWithoutReset(),refreshAutoComplete(),sharePermissionConatiner.show(),manageAccessButton.show(),shareDoneBtnObj.show(),manageAccessBackButton.hide(),hideManageAccessContainer(),accessModeContainer.hide(),accessModeChngBtnObj.hide(),accessModeCancelBtnObj.hide(),displaySharedUserGroupInfo(),currentItemDetail.ItemType==ItemType.Report&&(void 0!==currentItemDetail.Extension&&".rdl"==currentItemDetail.Extension.toLowerCase()?getEmbedLinkSection.show():getEmbedLinkSection.hide()),embedCodeDoneBtnObj.hide(),sharePermissionDlgHeaderItemName.show(),sharePermisisonDlgHeader.css("line-height",""),refreshDialogBoxPosition()}function showSharePermissionContainerWithRefresh(){$('[data-bs-toggle="popover"]').popover("hide"),resetToActualScope(),hideManageAccessContainer(),enableAutocompleteAccessModeSelectionWithoutReset(),autoCompleteHiddenEle.attr("data-itemtype")!=ItemType.UserManagement?sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.SharePermissionDefault):sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.AddGroupOwnerBtn),displaySharedUserGroupInfo(),dummyContainer.show(),shareBtnObj.text(window.Server.App.LocalizationContent.SharePeopleBtn),addOwnerBtnObj.text(window.Server.App.LocalizationContent.AddGroupOwnerBtn),showPublicPrivateContent(),sharePermissionConatiner.show(),manageAccessButton.show(),""!=autoCompleteInstance.getValue()?(autoCompleteHiddenEle.attr("data-itemtype")!=ItemType.UserManagement?shareBtnObj.show():addOwnerBtnObj.show(),manageAccessCancelBtnObj.show(),shareDoneBtnObj.hide()):shareDoneBtnObj.show(),manageAccessBackButton.hide(),accessModeContainer.hide(),accessModeChngBtnObj.hide(),accessModeCancelBtnObj.hide(),refreshDialogBoxPosition()}function showDashboardSettingContent(){sharePermissionPublicSectionObj.hide(),sharePermissionPrivateSectionObj.hide(),sharePermissionDashboardSettingSectionObj.show()}function showPublicContent(){sharePermissionPublicSectionObj.show(),sharePermissionPrivateSectionObj.hide(),isItemPublic=!0}function showPrivateContent(){sharePermissionPublicSectionObj.hide(),sharePermissionPrivateSectionObj.show(),isItemPublic=!1}function showPublicOrPrivateContent(){isItemPublic?showPublicContent():showPrivateContent()}function showShareUserGroupPermissionSection(){sharePermissionUserGroupSectionObj.show()}function hideShareUserGroupPermissionSection(){sharePermissionUserGroupSectionObj.hide()}function hidePublicPrivateContent(){sharePermissionPublicSectionObj.hide(),sharePermissionPrivateSectionObj.hide(),sharePermissionDashboardSettingSectionObj.hide()}function showPublicPrivateContent(){var e=null!=window.granularPermissions&&window.granularPermissions.Report;currentItemDetail.ItemType==ItemType.Report&&(currentItemDetail.CreatedById==currentUserId||isAdmin||e)?isMarkItemsPublic?isItemPublic?sharePermissionPublicSectionObj.show():sharePermissionPrivateSectionObj.show():sharePermissionDashboardSettingSectionObj.show():hidePublicPrivateContent()}function changeAccessMode(){sharePermissionDlgWrapperObj.ejWaitingPopup("show"),showAccessModeContainer(),isItemPublic?publicRadioBtnObj.prop("checked",!0):privateRadioBtnObj.prop("checked",!0),accessModeChngBtnObj.attr("disabled",!0),sharePermissionDlgWrapperObj.ejWaitingPopup("hide")}function getEmbedCode(){$("#embed-code").val(generateEmbedCode(currentItemDetail)),embedCodeContainer.show(),sharePermisisonDlgHeader.text(window.Server.App.LocalizationContent.EmbedCode),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&getEmbedCodeCopyBtnobj.hide(),currentItemDetail.IsPublic?($(".private-embed-code-note").hide(),$(".public-embed-code-note").show()):($(".private-embed-code-note").show(),$(".public-embed-code-note").hide()),embedCodeDoneBtnObj.show(),manageAccessBackButton.hide(),manageAccessSaveBtnObj.hide(),manageAccessCancelBtnObj.hide(),sharePermissionDlgHeaderItemName.hide(),sharePermisisonDlgHeader.css("line-height","32px"),sharePermissionConatiner.hide(),manageAccessButton.hide(),shareBtnObj.hide(),shareDoneBtnObj.hide(),refreshDialogBoxPosition()}function addAttributeValueToBtnEle(e){accessModeChngBtnObj.attr("data-item-id",e.Id),accessModeChngBtnObj.attr("data-name",e.Name),accessModeChngBtnObj.attr("data-itemtype",e.ItemType),shareBtnObj.attr("data-item-id",e.Id),shareBtnObj.attr("data-name",e.Name),shareBtnObj.attr("data-itemtype",e.ItemType)}function addAttributeValueToAutoCompleteEle(e){autoCompleteHiddenEle.attr("data-item-id",e.Id),autoCompleteHiddenEle.attr("data-itemtype",e.ItemType)}function getShareItemPermission(e){sharePermissionDlgWrapperObj.ejWaitingPopup("show"),$.ajax({type:"get",url:getShareItemPermissionUrl,data:{itemId:e},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(e.status){var o=angular.element(manageUserGroupBodySection).scope();o.$apply(function(){angular.copy(e.SharedUserGroupList,sharedUserGroupsPreservedList),o.sharedUserGroups=e.SharedUserGroupList}),o.$apply(function(){angular.copy(e.AccessModeOptionList,sharedAccessModePreservedList),o.accessModes=e.AccessModeOptionList}),$(".change-access-mode-selection").selectpicker("destroy"),$(".change-access-mode-selection").selectpicker(),$(".change-access-mode-selection .selectpicker").removeAttr("title"),accessModeSelectionInput.html("");var t=$($.parseHTML(e.AccessModeList));t.length>0&&$(t[0]).attr("selected","selected"),accessModeSelectionInput.append(t),accessModeSelectionInput.selectpicker("destroy"),accessModeSelectionInput.selectpicker(),refreshUserGroupScroll(),sharePermissionDlgWrapperObj.ejWaitingPopup("hide"),displaySharedUserGroupInfo(),isEntireDOMRendered=!0,$('[data-bs-toggle="tooltip"]').tooltip(),$('[data-bs-toggle="popover"]').popover()}},error:function(){WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3),sharePermissionDlgWrapperObj.ejWaitingPopup("hide")}})}function getGroupUserPermission(e){"undefined"!=typeof BoldBIDashboard?sharePermissionDlgWrapperObj.BoldBIDashboardWaitingPopup("show"):sharePermissionDlgWrapperObj.ejWaitingPopup("show"),$.ajax({type:"get",url:getGroupOwnersUrl,data:{groupId:e},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(e.status){var o=angular.element(manageUserGroupBodySection).scope();o.$apply(function(){angular.copy(e.SharedUserGroupList,sharedUserGroupsPreservedList),o.sharedUserGroups=e.SharedUserGroupList}),o.$apply(function(){angular.copy(e.AccessModeOptionList,sharedAccessModePreservedList),o.accessModes=e.AccessModeOptionList}),currentItemDetail.ItemType==ItemType.UserManagement?$("#user-group-search-input_suggestion").removeClass("item-user-input_suggestion"):$("#user-group-search-input_suggestion").addClass("item-user-input_suggestion"),$(".change-access-mode-selection").selectpicker("destroy"),$(".change-access-mode-selection").selectpicker(),$(".change-access-mode-selection .selectpicker").removeAttr("title"),$(".change-access-mode-selection span").removeClass("caret"),$(".change-access-mode-selection button").attr("disabled",!0),accessModeSelectionInput.html("");var t=$($.parseHTML(e.AccessModeList));t.length>0&&$(t[0]).attr("selected","selected"),accessModeSelectionInput.append(t),accessModeSelectionInput.selectpicker("destroy"),accessModeSelectionInput.selectpicker(),refreshUserGroupScroll(),"undefined"!=typeof BoldBIDashboard?sharePermissionDlgWrapperObj.BoldBIDashboardWaitingPopup("hide"):sharePermissionDlgWrapperObj.ejWaitingPopup("hide"),displaySharedUserGroupInfo(),isEntireDOMRendered=!0,$('[data-bs-toggle="tooltip"]').tooltip(),$('[data-bs-toggle="popover"]').popover()}else null!=e.permissionDenied&&e.permissionDenied&&(WarningAlert(window.Server.App.LocalizationContent.AddGroupOwnerBtn,window.Server.App.LocalizationContent.UserManagementWarningAlert,7e3),"undefined"!=typeof BoldBIDashboard?(sharePermissionDlgObj.BoldBIDashboardDialog("close"),sharePermissionDlgWrapperObj.BoldBIDashboardWaitingPopup("hide")):(sharePermissionDlgObj.ejDialog("close"),sharePermissionDlgWrapperObj.ejWaitingPopup("hide")))},error:function(){WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3),"undefined"!=typeof BoldBIDashboard?sharePermissionDlgWrapperObj.BoldBIDashboardWaitingPopup("hide"):sharePermissionDlgWrapperObj.ejWaitingPopup("hide")}})}function displaySharedUserGroupInfo(){var e=angular.element(manageUserGroupBodySection).scope().sharedUserGroups;if(null!=e){if(e.length>0){var o="";$.each(e,function(t,r){var s="<div class='shared-user-group-name'><span class='shared-user-group-name-label'>";t<3&&(r.TargetUserId>0?s+=r.DisplayName+"</span>":s+=r.TargetGroupName+"</span>",t!=e.length-1?s+="<span class='shared-user-group-name-comma'>,</span> </div>":s+="</div>",o+=s)}),showSharedUserGroupNameSection.html(o),manageUserGroupContainer.is(":visible")||showSharedUserGroupContainer.show()}else showSharedUserGroupContainer.hide();if(e.length>3){var t=e.length-3;showSharedUserGroupCount.text(t),showSharedUserGroupCountSection.show()}else showSharedUserGroupCountSection.hide();generateProfileAvatar()}}function saveItemPermission(){sharePermissionDlgWrapperObj.ejWaitingPopup("show"),splitUserGroupList();var e=userEmailList,o=groupIdList,t=accessModeSelectionInput.val(),r=shareBtnObj.attr("data-item-id"),s=shareBtnObj.attr("data-itemtype");$.ajax({type:"POST",url:sharepermissionUrl,data:{permissionList:JSON.stringify({mode:t,itemType:s,UserList:e,GroupList:o}),itemId:r},success:function(e,o){"true"==e.toString().toLowerCase()?(getShareItemPermission(r),refreshAutoComplete(),refreshAutocompleteAccessModeSelection()):WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)},error:function(){WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)}})}function addGroupOwnerPermission(){"undefined"!=typeof BoldBIDashboard?sharePermissionDlgWrapperObj.BoldBIDashboardWaitingPopup("show"):sharePermissionDlgWrapperObj.ejWaitingPopup("show"),splitUserGroupList();var e=userEmailList,o=groupIdList,t=accessModeSelectionInput.val(),r=addOwnerBtnObj.attr("data-item-id"),s=addOwnerBtnObj.attr("data-itemtype");$.ajax({type:"POST",url:addGroupOwnerPermissionUrl,data:{permissionList:JSON.stringify({mode:t,itemType:s,UserList:e,GroupList:o}),groupId:r},success:function(e,o){e.status?(getGroupUserPermission(r),refreshAutoComplete(),refreshAutocompleteAccessModeSelection()):null!=e.permissionDenied&&e.permissionDenied&&(WarningAlert(window.Server.App.LocalizationContent.AddGroupOwnerBtn,window.Server.App.LocalizationContent.UserManagementWarningAlert,7e3),"undefined"!=typeof BoldBIDashboard?(sharePermissionDlgObj.BoldBIDashboardDialog("close"),sharePermissionDlgWrapperObj.BoldBIDashboardWaitingPopup("hide")):(sharePermissionDlgObj.ejDialog("close"),sharePermissionDlgWrapperObj.ejWaitingPopup("hide")))},error:function(){WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)}})}function updateBulkItemPermission(){var e=shareBtnObj.attr("data-item-id"),o=addOwnerBtnObj.attr("data-item-id");$.ajax({type:"POST",url:updateBulkItemPermissionUrl,data:{permissionList:addNewItemPermission,userMarkedForDeletionList:userMarkedForDeletionList,groupMarkedForDeletionList:groupMarkedForDeletionList,itemId:e,groupId:o},success:function(t,r){"true"==t.toString().toLowerCase()?(null!=e?getShareItemPermission(e):getGroupUserPermission(o),changeIndicatorBannerObj.css("visibility","hidden"),resetPreRequestValues(),manageAccessSaveBtnObj.hide(),manageAccessCancelBtnObj.hide(),shareDoneBtnObj.show(),enableAutomCompleteControl(),enableAutocompleteAccessModeSelection()):WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)},error:function(){WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)}})}function refreshDialogBoxPosition(){sharePermissionDlgObj.ejDialog({height:"auto"}),isEntireDOMRendered&&(sharePermissionDlgObj.ejDialog({width:529}),sharePermissionDlgObj.ejDialog({width:530})),sharePermissionDlgWrapperObj.ejWaitingPopup("refresh"),sharePermissionDlgObj.ejDialog("refresh")}function prepareRequestForAddItemPermission(){if(modifiedItemIndex.length>0){var e=angular.element(manageUserGroupBodySection).scope(),o=e.accessModes,t=e.sharedUserGroups,r=shareBtnObj.attr("data-itemtype");$.each(o,function(o,s){var i=s.Key,n=[],a=[];$.each(modifiedItemIndex,function(o,r){t[r].PermissionAccess!=sharedUserGroupsPreservedList[r].PermissionAccess&&t[r].PermissionAccess==s.Key&&(e.IsUserItem(r)?-1==jQuery.inArray(t[r].Email,n)&&n.push(t[r].Email):e.IsGroupItem(r)&&-1==jQuery.inArray(t[r].TargetGroupId,a)&&a.push(t[r].TargetGroupId))}),(n.length>0||a.length>0)&&addNewItemPermission.push(JSON.stringify({mode:i,itemType:r,UserList:n,GroupList:a}))}),$.each(modifiedItemIndex,function(o,r){t[r].PermissionAccess!=sharedUserGroupsPreservedList[r].PermissionAccess&&(e.IsUserItem(r)?-1==jQuery.inArray(sharedUserGroupsPreservedList[r].PermissionId,userMarkedForDeletionList)&&userMarkedForDeletionList.push(sharedUserGroupsPreservedList[r].PermissionId):e.IsGroupItem(r)&&-1==jQuery.inArray(sharedUserGroupsPreservedList[r].PermissionId,groupMarkedForDeletionList)&&groupMarkedForDeletionList.push(sharedUserGroupsPreservedList[r].PermissionId))})}}function resetPreRequestValues(){modifiedItemIndex=[],addNewItemPermission=[],userMarkedForDeletionList=[],groupMarkedForDeletionList=[]}function resetToActualScope(){var e=angular.element(manageUserGroupBodySection).scope();e.$apply(function(){angular.copy(sharedUserGroupsPreservedList,e.sharedUserGroups)}),e.$apply(function(){angular.copy(sharedAccessModePreservedList,e.accessModes)}),$(".change-access-mode-selection").selectpicker("destroy"),$(".change-access-mode-selection").selectpicker(),$(".change-access-mode-selection .selectpicker").removeAttr("title"),changeIndicatorBannerObj.css("visibility","hidden"),resetPreRequestValues(),$('[data-bs-toggle="tooltip"]').tooltip(),manageAccessSaveBtnObj.hide(),manageAccessCancelBtnObj.hide(),shareBtnObj.hide(),shareDoneBtnObj.show()}function enableAutocompleteAccessModeSelectionWithoutReset(){autoCompleteControlEle.ejAutocomplete("enable"),autoCompleteControlWrapperEle.find(".e-in-wrap.e-box.e-corner").removeClass("disable-autocomplete"),accessModeSelectionInput.prop("disabled",!1),$(".selectpicker[data-id='access-mode-selection']").removeClass("disabled"),$(".selectpicker[data-id='access-mode-selection']").removeClass("disable-autocomplete-access-mode-selection"),accessModeSelectionInput.selectpicker("destroy"),accessModeSelectionInput.selectpicker()}function refreshAutocompleteAccessModeSelection(){accessModeSelectionInput.prop("selectedIndex",0),accessModeSelectionInput.selectpicker("destroy"),accessModeSelectionInput.selectpicker()}function enableAutocompleteAccessModeSelection(){accessModeSelectionInput.prop("disabled",!1),$(".selectpicker[data-id='access-mode-selection']").removeClass("disabled"),$(".selectpicker[data-id='access-mode-selection']").removeClass("disable-autocomplete-access-mode-selection"),refreshAutocompleteAccessModeSelection()}function disableAutocompleteAccessModeSelection(){accessModeSelectionInput.prop("disabled",!0),$(".selectpicker[data-id='access-mode-selection']").addClass("disabled"),$(".selectpicker[data-id='access-mode-selection']").addClass("disable-autocomplete-access-mode-selection"),refreshAutocompleteAccessModeSelection()}function onSuggestionListOpen(){$("#user-group-search-input_suggestion li").each(function(){$(this).addClass("d-flex align-items-center")}),manageUserGroupContainer.addClass("disable-element-opacity")}function onSuggestionListClose(){""==autoCompleteInstance.getValue()&&manageUserGroupContainer.removeClass("disable-element-opacity")}function refreshUserGroupScroll(){if(manageUserGroupBodySection.is(":visible")){$(".tooltip").tooltip("hide");manageUserGroupBodySection.ejScroller({height:225,width:"100%",scrollerSize:7,buttonSize:0,enableTouchScroll:!0,scrollOneStepBy:20,scroll:function(){$(".tooltip").tooltip("hide"),$('[data-bs-toggle="popover"]').popover("hide")}});var e=manageUserGroupBodySection.ejScroller("instance");e.model.height=225,e.refresh(),$(".manage-user-group-body-section .e-scrollbar").show(),generateProfileAvatar()}}function generateEmbedCode(e){$("#embed-sso").change(function(){$(this).is(":checked")?$(".auth-provider-row").slideDown():$(".auth-provider-row").slideUp()}),$("#sso-providers").change(function(){var o=getDashboardShareLink(e.Id,e.CategoryName,e.Name)+"?isembed=true";if(o+=$("#embed-dashboard-comments").is(":checked")?"&report_comments=true":"",o+=$("#embed-views").is(":checked")?"&views=true":"",o+=$("#embed-export").is(":checked")?"&export=true":"",o+=$("#embed-sso").is(":checked")?"&hassso=true":"",$("#embed-sso").is(":checked"))switch($(this).val()){case"AzureAD":o+="&externallogin=azuread";break;case"OAuth":o+="&externallogin=oauth";break;case"OpenID":o+="&externallogin=openid";break;case"WindowsAD":o+="&externallogin=windowsad"}var t="<iframe src='"+o+"' id='report-frame' width='100%' height='720px' allowfullscreen frameborder='0'></iframe>";$("#embed-code").val(t)});var o=getDashboardShareLink(e.Id,e.CategoryName,e.Name)+"?isembed=true";return o+=$("#embed-dashboard-comments").is(":checked")?"&report_comments=true":"",o+=$("#embed-views").is(":checked")?"&views=true":"",o+=$("#embed-export").is(":checked")?"&export=true":"","<iframe src='"+(o+=$("#embed-sso").is(":checked")?"&hassso=true":"")+"' id='report-frame' width='100%' height='720px' allowfullscreen frameborder='0'></iframe>"}function extractXSRFTokenFromCookie(){var e=parent.document.cookie.split("; ").find(e=>e.startsWith("XSRF-TOKEN="));return e?e.split("=")[1]:null}function setXSRFRequestHeader(e){e.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(e){var o=document.createElement("textarea");return o.innerHTML=e,o.value}function EscapeHtml(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}shareItem.controller("shareItemController",["$scope",function(e){e.currentUserId=window.currentUserId,e.sharedUserGroups=window.sharedUserGroupList,e.currentItemType=ItemType.Report,e.accessModes=window.accessModeList,e.showPopover=!1,e.hasDashboardSettingsPermission=!1,e.isUnlisted=!1,e.formatAccessModeString=function(e){return e.toString()},e.ImageLink=function(e){return idpUrl+"/User/Avatar?id="+e+"&ImageSize=64"};e.GetGroupColor=function(e,o){return{"background-color":"#dfdfdf"}},e.typeOptions=[{Key:2,Value:"Read"}],e.parseInt=function(e){return parseInt(e,10)},e.updateValue=function(o,t){e.CheckForModification(o,t)},e.MarkForDeletion=function(o,t,r){e.AddItemInUserGroupDeletionList(r),e.RemoveFromModified(r);var s=angular.element(o.currentTarget).parents(".shared-user-group-list-section").children();s.find(".action-for-delete-container").hide();var i=s.find(".marked-for-delete-container");s.find(".marked-for-delete-container").show(),i.css({display:"flex"}),s.find(".change-indicator").show(),e.ShowChangeIndicatorBanner()},e.RemoveMarkForDeletion=function(o,t,r){e.RemoveItemInUserGroupDeletionList(r);var s=angular.element(o.currentTarget).parents(".shared-user-group-list-section").children();s.find(".marked-for-delete-container").hide(),s.find(".action-for-delete-container").show(),s.find(".change-indicator").hide(),e.CheckForModification(t,r)},e.CheckForModification=function(o,t){sharedUserGroupsPreservedList[t].PermissionAccess!=o?(e.AddToModified(t),$("#select_"+t).parents(".shared-user-group-list-section").children().find(".change-indicator").show()):sharedUserGroupsPreservedList[t].PermissionAccess==o&&(e.RemoveFromModified(t),$("#select_"+t).parents(".shared-user-group-list-section").children().find(".change-indicator").hide()),e.ShowChangeIndicatorBanner()},e.ShowChangeIndicatorBanner=function(){$(".change-indicator").is(":visible")?(changeIndicatorBannerObj.css("visibility","visible"),manageAccessSaveBtnObj.show(),manageAccessCancelBtnObj.show(),shareDoneBtnObj.hide(),disableAutomCompleteControl(),disableAutocompleteAccessModeSelection()):(changeIndicatorBannerObj.css("visibility","hidden"),resetPreRequestValues(),manageAccessSaveBtnObj.hide(),manageAccessCancelBtnObj.hide(),shareDoneBtnObj.show(),enableAutomCompleteControl(),enableAutocompleteAccessModeSelection())},e.AddItemInUserGroupDeletionList=function(o){e.IsUserItem(o)?-1==jQuery.inArray(sharedUserGroupsPreservedList[o].PermissionId,userMarkedForDeletionList)&&userMarkedForDeletionList.push(sharedUserGroupsPreservedList[o].PermissionId):e.IsGroupItem(o)&&-1==jQuery.inArray(sharedUserGroupsPreservedList[o].PermissionId,groupMarkedForDeletionList)&&groupMarkedForDeletionList.push(sharedUserGroupsPreservedList[o].PermissionId)},e.RemoveItemInUserGroupDeletionList=function(o){e.IsUserItem(o)?-1!=jQuery.inArray(sharedUserGroupsPreservedList[o].PermissionId,userMarkedForDeletionList)&&(userMarkedForDeletionList=jQuery.grep(userMarkedForDeletionList,function(e){return e!=sharedUserGroupsPreservedList[o].PermissionId})):e.IsGroupItem(o)&&-1!=jQuery.inArray(sharedUserGroupsPreservedList[o].PermissionId,groupMarkedForDeletionList)&&(groupMarkedForDeletionList=jQuery.grep(groupMarkedForDeletionList,function(e){return e!=sharedUserGroupsPreservedList[o].PermissionId}))},e.AddToModified=function(e){-1==jQuery.inArray(e,modifiedItemIndex)&&modifiedItemIndex.push(e)},e.RemoveFromModified=function(e){modifiedItemIndex=jQuery.grep(modifiedItemIndex,function(o){return o!=e})},e.IsUserItem=function(e){return null!=sharedUserGroupsPreservedList[e].Email&&sharedUserGroupsPreservedList[e].IsUserPermission&&sharedUserGroupsPreservedList[e].TargetUserId>0},e.IsGroupItem=function(e){return null==sharedUserGroupsPreservedList[e].Email&&!sharedUserGroupsPreservedList[e].IsUserPermission&&sharedUserGroupsPreservedList[e].TargetGroupId>0},e.GetManagePermisisionContent=function(o){var t=null!=window.granularPermissions&&window.granularPermissions.Reports,r=window.Server.App.LocalizationContent.RemoveAccess;if(e.IsUserItem(o)){if(r=r+window.Server.App.LocalizationContent.PermissionGlobally+" - <strong>"+sharedUserGroupsPreservedList[o].PermissionEntityDescription+"</strong>.</br></br>",isAdmin||t){var s=editUserPermissionUrl+"?userId="+sharedUserGroupsPreservedList[o].TargetUserId;return r+window.Server.App.LocalizationContent.ManagePermission+" <a target='_blank' href='"+s+"'>"+window.Server.App.LocalizationContent.Here+"</a>."}return r+window.Server.App.LocalizationContent.UserContactSystemAdministrator}if(r=r+window.Server.App.LocalizationContent.AssignedGlobally+" - <strong>"+sharedUserGroupsPreservedList[o].PermissionEntityDescription+"</strong>.</br></br>",isAdmin){var i=editGroupPermissionUrl+"?groupId="+sharedUserGroupsPreservedList[o].TargetGroupId;return r+window.Server.App.LocalizationContent.ManagePermission+" <a target='_blank' href='"+i+"'>"+window.Server.App.LocalizationContent.Here+"</a>."}return r+window.Server.App.LocalizationContent.GroupContactSystemAdministrator}}]),$(function(){sharePermissionDlgObj=$("#share-permission-popup"),sharePermisisonDlgHeader=$("#share-permission-dialog-header"),sharePermissionDlgHeaderItemName=$(".item-name-container #item-name-header"),sharePermissionConatiner=$("#share-permission-container"),accessModeContainer=$("#access-mode-container"),dummyContainer=$("#dummy-container"),embedCodeContainer=$("#get-embed-code-container"),sharePermissionDashboardSettingSectionObj=$(".share-permission-dashboard-setting-section"),sharePermissionPublicSectionObj=$(".share-permission-public-section"),sharePermissionPrivateSectionObj=$(".share-permission-private-section"),sharePermissionUserGroupSectionObj=$("#assign-user-group-container"),manageUserGroupContainer=$("#manage-user-group-container"),manageUserGroupBodySection=$(".manage-user-group-body-section"),getEmbedLinkSection=$(".get-item-embed-link-section"),changeIndicatorBannerObj=$(".changes-indicator-banner"),shareWithLabelObj=$(".share-with-label"),getLinkInputObj=$("#item-url"),getLinkCopyLinkobj=$("#item-url-copy"),getEmbedCodeInputObj=$("#embed-code"),getEmbedCodeCopyBtnobj=$("#copy-embed-code"),accessModeChangeLink=$("#access-mode-change-link"),manageAccessButton=$("#manage-access-button"),manageAccessBackButton=$("#manage-access-back-button"),manageAccessSaveBtnObj=$("#manage-access-save-button"),manageAccessCancelBtnObj=$("#manage-access-cancel-button"),shareDoneBtnObj=$("#share-done-popup-button"),shareBtnObj=$("#share-permission-button"),accessModeChngBtnObj=$("#access-mode-change-button"),accessModeCancelBtnObj=$("#access-mode-cancel-button"),embedCodeDoneBtnObj=$("#copy-embed-code-done-button"),addOwnerBtnObj=$("#add-owner-permission-button"),publicRadioBtnObj=$("#public-access-mode"),privateRadioBtnObj=$("#private-access-mode"),accessModeSelectionInput=$("#access-mode-selection"),markForDeleteBtnObj=$(".mark-for-deletion-icon"),removeMarkForDeleteBtnObj=$(".remove-mark-for-deletion-icon"),showSharedUserGroupContainer=$("#show-shared-user-group-container"),showSharedUserGroupNameSection=$(".shared-user-group-name-section"),showSharedUserGroupName=$(".shared-user-group-name"),showSharedUserGroupCountSection=$(".shared-user-group-count-section"),showSharedUserGroupCount=$(".shared-user-group-count"),toggleMarkForDeletionObj=$(".action-for-delete-container, .marked-for-delete-container"),$("#permission-popup").ejDialog({showOnInit:!1,allowDraggable:!0,enableResize:!1,width:"900px",title:"",showHeader:!1,enableModal:!0,close:"DialogBoxClose",closeOnEscape:!0});var e=createLoader("permission-popup_wrapper");$("#permission-popup_wrapper").ejWaitingPopup({template:$("#"+e)}),sharePermissionDlgObj.ejDialog({width:"529px",showOnInit:!1,allowDraggable:!1,enableResize:!1,showHeader:!1,enableModal:!0,closeOnEscape:!1,close:"onSharePermissionPopupClose",open:"onSharePermissionPopupOpen",closeOnEscape:!0}),sharePermissionDlgWrapperObj=$("#share-permission-popup_wrapper");var o=createLoader("share-permission-popup_wrapper");sharePermissionDlgWrapperObj.ejWaitingPopup({template:$("#"+o)}),$("#share-close-popup, #share-done-popup-button").on("click",function(){sharePermissionDlgObj.ejDialog("close"),parent.$("#sharePermissionPopup_iframe").hide()}),accessModeCancelBtnObj.on("click",function(){showSharePermissionContainer()}),manageAccessButton.on("click",function(){showManageAccessContainer()}),manageAccessBackButton.on("click",function(){showSharePermissionContainerWithRefresh()}),manageAccessSaveBtnObj.on("click",function(){$('[data-bs-toggle="popover"]').popover("hide"),sharePermissionDlgWrapperObj.ejWaitingPopup("show"),prepareRequestForAddItemPermission(),updateBulkItemPermission()}),manageAccessCancelBtnObj.on("click",function(){$('[data-bs-toggle="popover"]').popover("hide"),resetToActualScope(),enableAutomCompleteControl(),enableAutocompleteAccessModeSelection()}),getLinkCopyLinkobj.on("click",function(e){getLinkInputObj.select(),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)?getLinkCopyLinkobj.attr("data-original-title",""):(document.execCommand("copy"),getLinkCopyLinkobj.attr("data-original-title",window.Server.App.LocalizationContent.Copysuccess),getLinkCopyLinkobj.tooltip("hide").attr("data-original-title",window.Server.App.LocalizationContent.Copysuccess).tooltip("fixTitle").tooltip("show"),setTimeout(function(){getLinkCopyLinkobj.attr("data-original-title",window.Server.App.LocalizationContent.LinkCopy),getLinkCopyLinkobj.tooltip()},3e3))}),getLinkCopyLinkobj.removeClass("focusdiv"),getLinkInputObj.on("focusin",function(){getLinkCopyLinkobj.addClass("focusdiv")}),getLinkInputObj.on("focusout",function(){getLinkCopyLinkobj.removeClass("focusdiv")}),$("input[type=radio][name=access-mode]").on("change",function(){isItemPublic&&privateRadioBtnObj.prop("checked")||!isItemPublic&&publicRadioBtnObj.prop("checked")?accessModeChngBtnObj.removeAttr("disabled"):accessModeChngBtnObj.attr("disabled",!0)}),$(document).on("click","#access-mode-change-button",function(e){var o=$(this).attr("data-item-id"),t=$(this).attr("data-name"),r=$(this).attr("data-itemtype"),s="";isItemPublic&&privateRadioBtnObj.prop("checked")?s=removeItemPublicUrl:!isItemPublic&&publicRadioBtnObj.prop("checked")&&(s=makeItemPublicUrl),$.ajax({type:"POST",url:s,data:{itemId:o,itemTypeId:r,itemName:t},success:function(e){e.validation&&e.result?("function"==typeof ResetItemList&&ResetItemList(ItemType.Report),void 0!==currentItemDetail&&void 0!==currentItemDetail.IsPublic&&(currentItemDetail.IsPublic=!currentItemDetail.IsPublic)):WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)},error:function(){WarningAlert("",window.Server.App.LocalizationContent.InternalServerError,7e3)}}),isItemPublic&&privateRadioBtnObj.prop("checked")?(showSharePermissionContainer(),showPrivateContent(),isItemPublic=!1):!isItemPublic&&publicRadioBtnObj.prop("checked")&&(showSharePermissionContainer(),showPublicContent(),isItemPublic=!0)}),$(document).on("shown.bs.dropdown",".user-group-scroll-content .change-access-mode-select",function(){if($(".tooltip").hide(),$(this).find(".change-access-mode-selection").length>0){var e=manageUserGroupBodySection,o=$(this).offset().top+$(this).outerHeight(!0)/2-e.offset().top,t=e.height()-($(this).offset().top-e.offset().top+$(this).outerHeight(!0)/2),r=$(this).find(".change-access-mode-selection .dropdown-menu").outerHeight(!0);t<=r&&o>=r?$(this).find(".change-access-mode-selection").removeClass("dropdown").addClass("dropup"):refreshUserGroupScroll()}}),$("body").on("click",function(e){if("popover"!==$(e.target).data("bs-toggle")&&0===$(e.target).closest('[data-bs-toggle="popover"]').length&&0===$(e.target).closest(".popover").length)$('[data-bs-toggle="popover"]').popover("hide");else if("popover"==$(e.target).data("bs-toggle")){var o=$(e.target),t=bootstrap.Popover.getInstance(o[0]);t&&t._isShown?o.popover("hide"):($(".access-info-icon").not(e.target).popover("hide"),o.popover("show"))}}),getEmbedCodeInputObj.on("click",function(e){getEmbedCodeInputObj.select()}),getEmbedCodeCopyBtnobj.on("click",function(e){getEmbedCodeInputObj.select(),document.execCommand("copy");var o=$(".embed-copy-success");o.show(),setTimeout(function(){o.fadeOut(3e3)},3e3)}),embedCodeDoneBtnObj.on("click",function(){sharePermissionDlgObj.ejDialog("close")}),$(".embed-configuration [type='checkbox']").on("change",function(e){$("#embed-code").val(generateEmbedCode(currentItemDetail))}),$(document).on("click","#share-permission-button",saveItemPermission)}),$.ajaxSetup({beforeSend:function(e){setXSRFRequestHeader(e)}});
